<!DOCTYPE html>
<html lang="en" translate="no">
<head>
<meta charset="UTF-8">
<meta name="google" content="notranslate">
<meta name="viewport" content="width=device-width, initial-initial-scale=1.0">
<title>Krishi Mitra - Signup</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<style>
:root{--primary-color:#4caf50;--secondary-color:#388e3c;}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{
    background:url('https://images.unsplash.com/photo-1625246333195-78d9c38ad449') center/cover;
    height:100vh;display:flex;justify-content:center;align-items:center;
}
.signup-card{background:#fff;padding:40px;border-radius:12px;width:100%;max-width:400px;text-align:center;}
.logo-area{display:flex;gap:10px;justify-content:center;font-weight:700;font-size:1.5rem;color:var(--primary-color);}
.logo-area span{color:var(--secondary-color);}
.input-group{margin-bottom:18px;text-align:left;}
label{font-weight:600;font-size:.9rem;display:block;margin-bottom:6px;}
.input-wrapper{position:relative;}
.input-wrapper i{position:absolute;left:15px;top:50%;transform:translateY(-50%);color:#aaa;}
.input-wrapper input{width:100%;padding:12px 15px 12px 45px;border:1px solid #ddd;border-radius:6px;}
.btn-signup{width:100%;padding:12px;background:var(--primary-color);color:#fff;border:none;border-radius:6px;font-weight:600;cursor:pointer;}
select{width:100%;padding:10px;border-radius:6px;border:1px solid #ddd;}
</style>
</head>

<body>

<div class="signup-card">
    <div class="logo-area">
        <i class="fa-solid fa-seedling"></i>
        <span id="appName">KRISHI MITRA</span>
    </div>

    <h2 id="title">Create an Account</h2>
    <p id="subtitle">Start your smart farming journey</p>

    <div class="input-group">
        <label id="langLabel">Language</label>
        <select id="languageSelect">
            <option value="ml">മലയാളം</option>
            <option value="en" selected>English</option>
        </select>
    </div>

    <form id="signup-form">
        <div class="input-group">
            <label id="lblName">Full Name</label>
            <div class="input-wrapper">
                <i class="fa fa-user"></i>
                <input id="name" required placeholder="Enter your full name">
            </div>
        </div>

        <div class="input-group">
            <label id="lblPhone">Phone Number</label>
            <div class="input-wrapper">
                <i class="fa fa-phone"></i>
                <input id="phone" required placeholder="Enter 10-digit mobile number">
            </div>
        </div>

        <div class="input-group">
            <label id="lblPass">Password</label>
            <div class="input-wrapper">
                <i class="fa fa-lock"></i>
                <input id="password" type="password" required placeholder="Minimum 6 characters">
            </div>
        </div>

        <button type="submit" class="btn-signup" id="btnSignup">Sign Up</button>
    </form>

    <p style="margin-top:15px;">
        <span id="already">Already have an account?</span>
        <a href="login.html" id="login">Login</a>
    </p>
</div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyA9Q1-_604mrZ4XeddMz2n0S5umTuLLuic",
    authDomain: "login-6e27a.firebaseapp.com",
    projectId: "login-6e27a",
    storageBucket: "login-6e27a",
    messagingSenderId: "728070142896",
    appId: "1:728070142896:web:ccfdd02a1bb5abff1af475"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

const text={
ml:{
app:"കൃഷി മിത്ര",title:"അക്കൗണ്ട് സൃഷ്ടിക്കുക",sub:"നിങ്ങളുടെ സ്മാർട്ട് കൃഷി യാത്ര ആരംഭിക്കൂ",
lang:"ഭാഷ തിരഞ്ഞെടുക്കുക",name:"പൂർണ്ണ പേര്",phone:"ഫോൺ നമ്പർ",pass:"പാസ്‌വേഡ്",
namePh:"നിങ്ങളുടെ പൂർണ്ണ പേര് നൽകുക",phonePh:"10 അക്ക മൊബൈൽ നമ്പർ നൽകുക",passPh:"കുറഞ്ഞത് 6 അക്ഷരങ്ങൾ",
signup:"സൈൻ അപ്പ്",already:"ഇതിനകം അക്കൗണ്ട് ഉണ്ടോ?",login:"ലോഗിൻ"
},
en:{
app:"KRISHI MITRA",title:"Create an Account",sub:"Start your smart farming journey",
lang:"Language",name:"Full Name",phone:"Phone Number",pass:"Password",
namePh:"Enter your full name",phonePh:"Enter 10-digit mobile number",passPh:"Minimum 6 characters",
signup:"Sign Up",already:"Already have an account?",login:"Login"
}
};

let lang="en"; // CHANGED: Set default language to English

function apply(){
    const t=text[lang];
    document.documentElement.lang=lang;
    
    const appName = document.getElementById('appName');
    const title = document.getElementById('title');
    const subtitle = document.getElementById('subtitle');
    const langLabel = document.getElementById('langLabel');
    const lblName = document.getElementById('lblName');
    const lblPhone = document.getElementById('lblPhone');
    const lblPass = document.getElementById('lblPass');
    const nameInput = document.getElementById('name');
    const phoneInput = document.getElementById('phone');
    const passwordInput = document.getElementById('password');
    const btnSignup = document.getElementById('btnSignup');
    const already = document.getElementById('already');
    const login = document.getElementById('login');

    if(appName) appName.innerText=t.app;
    if(title) title.innerText=t.title;
    if(subtitle) subtitle.innerText=t.sub;
    if(langLabel) langLabel.innerText=t.lang;
    if(lblName) lblName.innerText=t.name;
    if(lblPhone) lblPhone.innerText=t.phone;
    if(lblPass) lblPass.innerText=t.pass;
    if(nameInput) nameInput.placeholder=t.namePh;
    if(phoneInput) phoneInput.placeholder=t.phonePh;
    if(passwordInput) passwordInput.placeholder=t.passPh;
    if(btnSignup) btnSignup.innerText=t.signup;
    if(already) already.innerText=t.already;
    if(login) login.innerText=t.login;
}

const languageSelect = document.getElementById('languageSelect');
if(languageSelect) {
    languageSelect.onchange=()=>{
        lang=languageSelect.value;
        apply();
    };
}

apply();


const signupForm = document.getElementById('signup-form');

if (signupForm) {
    signupForm.addEventListener('submit', async (e) => {
        e.preventDefault(); 
        
        const fullName = document.getElementById('name').value.trim();
        const phoneNumber = document.getElementById('phone').value.trim();
        const userPassword = document.getElementById('password').value;
        const btnSignup = document.getElementById('btnSignup');
        const isMalayalam = lang === 'ml';

        if (!fullName || !phoneNumber || !userPassword) {
            alert(isMalayalam ? "എല്ലാ ഫീൽഡുകളും പൂരിപ്പിക്കുക." : "Please fill in all fields.");
            return;
        }
        if (!/^\d{10}$/.test(phoneNumber)) {
            alert(isMalayalam ? "കൃത്യമായ 10 അക്ക ഫോൺ നമ്പർ നൽകുക." : "Please enter a valid 10-digit phone number.");
            return;
        }
        if (userPassword.length < 6) {
            alert(isMalayalam ? "പാസ്‌വേഡ് കുറഞ്ഞത് 6 അക്ഷരങ്ങളെങ്കിലും ഉണ്ടായിരിക്കണം." : "Password must be at least 6 characters long.");
            return;
        }
        
        const userEmail = `${phoneNumber}@krishimitra-temp.com`; 

        try {
            if (btnSignup) {
                btnSignup.disabled = true;
                btnSignup.innerText = isMalayalam ? 'സൃഷ്ടിക്കുന്നു...' : 'Creating...';
            }
            
            const userCredential = await auth.createUserWithEmailAndPassword(userEmail, userPassword);
            const user = userCredential.user;

            await user.updateProfile({
                displayName: fullName
            });
            
            alert(isMalayalam
                ? `അക്കൗണ്ട് വിജയകരമായി സൃഷ്ടിച്ചു! സ്വാഗതം, ${fullName}` 
                : `Account created successfully! Welcome, ${fullName}`); 

        } catch (error) {
            console.error("Firebase Signup Error:", error);
            let errorMessage = isMalayalam ? 'അക്കൗണ്ട് സൃഷ്ടിക്കുന്നതിൽ പിശകുണ്ടായി: ' : 'Error creating account: ';

            if (error.code === 'auth/email-already-in-use') {
                 errorMessage += isMalayalam ? 'ഈ ഫോൺ നമ്പർ ഉപയോഗിച്ച് ഒരു അക്കൗണ്ട് ഇതിനകം ഉണ്ട്.' : 'An account with this phone number already exists.';
            } else if (error.code === 'auth/weak-password') {
                errorMessage += isMalayalam ? 'പാസ്‌വേഡ് വളരെ ദുർബലമാണ്. കുറഞ്ഞത് 6 അക്ഷരങ്ങൾ വേണം.' : 'Password is too weak. Must be at least 6 characters.';
            } else if (error.code === 'auth/network-request-failed') {
                errorMessage += isMalayalam ? 'നെറ്റ്‌വർക്ക് കണക്ഷൻ തകരാർ, ദയവായി വീണ്ടും ശ്രമിക്കുക.' : 'Network error, please try again.';
            } else {
                errorMessage += error.message;
            }

            alert(errorMessage);
        } finally {
            if (btnSignup) {
                btnSignup.disabled = false;
                btnSignup.innerText = text[lang].signup;
            }
        }
    });
}

(function () {
    const audioFiles = {
        ml: "guide_ml.mp3",
        en: "guide_en.mp3"
    };

    const segments = {
        name:  [0, 4],   
        phone: [4, 8],   
        pass:  [8, 13],  
        next:  [13, 20]  
    };

    const audio = new Audio();
    let endTime = 0;

    function playSegment(key) {
        const file = audioFiles[lang];
        const seg = segments[key];
        if (!file || !seg) return;
        audio.src = file;
        audio.currentTime = seg[0];
        endTime = seg[1];
        const p = audio.play();
        if (p && typeof p.catch === "function") {
            p.catch(() => {
                document.body.addEventListener("click", function once() {
                    document.body.removeEventListener("click", once);
                    playSegment(key);
                }, { once: true });
            });
        }
    }

    audio.addEventListener("timeupdate", () => {
        if (audio.currentTime >= endTime) audio.pause();
    });

    const nameElement = document.getElementById("name");
    const phoneElement = document.getElementById("phone");
    const passwordElement = document.getElementById("password");
    const btnSignupElement = document.getElementById("btnSignup");

    if (languageSelect) {
        languageSelect.addEventListener("change", () => {
            playSegment("name");
        });
    }

    if (nameElement) nameElement.addEventListener("focus", () => playSegment("name"));
    if (phoneElement) phoneElement.addEventListener("focus", () => playSegment("phone"));
    if (passwordElement) passwordElement.addEventListener("focus", () => playSegment("pass"));
    if (btnSignupElement) btnSignupElement.addEventListener("focus", () => playSegment("next"));

    playSegment("name");
})();
</script>

</body>
</html>