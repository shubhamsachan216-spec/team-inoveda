<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Krishi-Mitra AI Advisory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fc; }

        
        .chat-container { overflow-y: auto; scrollbar-width: thin; scrollbar-color: #888 #f1f1f1; }
        .chat-container::-webkit-scrollbar { width: 8px; }
        .chat-container::-webkit-scrollbar-track { background: #f1f1f1; }
        .chat-container::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        .chat-container::-webkit-scrollbar-thumb:hover { background: #555; }

        
        .message-bubble {
            border-radius: 1rem;
            max-width: 80%;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            word-wrap: break-word;
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        
        .user-message {
            background-color: #4CAF50;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 0.25rem;
            background-image: linear-gradient(135deg, #4CAF50, #66BB6A);
        }

      
        .ai-message { background-color: #E3F2FD; color: #333; align-self: flex-start; border-bottom-left-radius: 0.25rem; display: flex; align-items: center; background-image: linear-gradient(135deg, #E3F2FD, #BBDEFB); }
        .ai-message p { flex-grow: 1; margin: 0; }
        
        
        .ai-message ul { padding-left: 20px; margin-top: 5px; margin-bottom: 5px; }
        .ai-message li { margin-bottom: 5px; }


       
        .message-timestamp { font-size: 0.65rem; color: rgba(255,255,255,0.7); margin-top: 0.25rem; align-self: flex-end; }
        .ai-message .message-timestamp { color: rgba(51, 51, 51, 0.6); align-self: flex-start; }
        .btn-primary { background-color: #3B82F6; color: white; border: none; cursor: pointer; transition: background-color 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn-primary:hover { background-color: #2563EB; }

        
        .loading-dots { display:flex; align-items:center; }
        .loading-dots .dot { width: 8px; height:8px; margin:0 2px; background-color:#333; border-radius:50%; animation: bounce 1.4s infinite ease-in-out both; }
        .loading-dots .dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dots .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%,80%,100% { transform: scale(0); } 40% { transform: scale(1); } }

        
        .speak-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            margin-left: 8px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 8px;
            border-radius: 8px;
            transition: background 0.15s;
        }
        .speak-btn:hover { background: rgba(0,0,0,0.05); }

        /* Floating voice toggle */
        .voice-toggle {
            position: fixed;
            right: 18px;
            bottom: 18px;
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 8px 12px;
            border-radius: 999px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
            border: 1px solid rgba(0,0,0,0.06);
            user-select: none;
        }
        .voice-dot { width: 12px; height: 12px; border-radius: 50%; }
        .voice-dot.on { background: #34D399; box-shadow: 0 0 6px rgba(52,211,153,0.3); }
        .voice-dot.off { background: #F87171; box-shadow: 0 0 6px rgba(248,113,113,0.2); }

      
        @media (max-width: 900px) {
            
            .hidden-lg { display: none; }
            .md\\:w-1\\/4 { width: 100% !important; }
            .md\\:w-1\\/2 { width: 100% !important; }
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col min-h-screen">
    <style>
        html, body { margin: 0; padding: 0; height: 100vh; width: 100%; }
        body { background-size: cover; background-repeat: no-repeat; background-attachment: fixed; }
    </style>

    <body class="flex flex-col items-center justify-center min-h-screen bg-center relative" style="background-image: url('ab.jpg');">
        <div class="absolute inset-0 bg-black bg-opacity-0"></div>

        <header class="bg-gradient-to-r from-gray-800 to-gray-900 text-white p-4 shadow-lg">
            <div class="container mx-auto flex justify-between items-center">
                <h1 class="text-xl font-bold"><i class="fas fa-leaf text-green-300 mr-2"></i>Krishi-Mitra AI Advisory</h1>
                <div class="flex items-center space-x-2 text-sm md:text-md">
                    <i class="fas fa-user-circle text-lg text-green-300"></i>
                    <span>Welcome,</span>
                    <span id="username-display" class="font-semibold text-green-300"></span>
                </div>
            </div>
        </header>

        <div class="flex-grow flex items-center justify-center p-4 w-full">
            <div class="bg-white rounded-3xl shadow-2xl p-6 md:p-8 w-11/12 max-w-7xl flex flex-col md:flex-row space-y-6 md:space-y-0 md:space-x-8 transform transition-all duration-500 max-h-[90vh] h-full overflow-auto md:overflow-hidden">

                <div class="w-full md:w-1/4 p-4 bg-gradient-to-br from-blue-50 to-green-50 rounded-2xl flex flex-col justify-between shadow-inner flex-shrink-0">
                    <div>
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-leaf text-green-600 text-3xl"></i>
                                <h1 class="text-3xl font-bold text-gray-800">Krishi-Mitra</h1>
                            </div>
                        </div>
                        <p class="text-gray-600 text-sm mb-6">AI-Powered Farmer Advisory</p>
                        <div class="grid grid-cols-2 gap-2 mb-6">
                            <button id="lang-en" class="bg-gray-200 text-gray-800 text-sm px-3 py-1 rounded-full hover:bg-gray-300 transition-colors">English</button>
                            <button id="lang-hi" class="bg-gray-200 text-gray-800 text-sm px-3 py-1 rounded-full hover:bg-gray-300 transition-colors">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
                            <button id="lang-ta" class="bg-gray-200 text-gray-800 text-sm px-3 py-1 rounded-full hover:bg-gray-300 transition-colors">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</button>
                            <button id="lang-kn" class="bg-gray-200 text-gray-800 text-sm px-3 py-1 rounded-full hover:bg-gray-300 transition-colors">‡≤ï‡≤®‡≥ç‡≤®‡≤°</button>
                            <button id="lang-ml" class="bg-gray-200 text-gray-800 text-sm px-3 py-1 rounded-full hover:bg-gray-300 transition-colors">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</button>
                        </div>
                        <div class="mt-8 flex flex-col items-center justify-center space-y-4">
                           <button id="dailyAdvisoryButton" class="btn-primary w-full p-3 rounded-xl shadow-lg">
                                <i class="fas fa-sun mr-2"></i>‚ú® Daily Advisory
                           </button>
                           <button id="imageAnalysisButton" class="btn-primary w-full p-3 rounded-xl shadow-lg">
                                <i class="fas fa-camera mr-2"></i>‚ú® Image Analysis
                           </button>
                           <button id="govtSchemesButton" class="btn-primary w-full p-3 rounded-xl shadow-lg">
                                <i class="fas fa-hand-holding-usd mr-2"></i>‚ú® Govt Schemes
                            </button>
                            <button id="marketPriceButton" class="btn-primary w-full p-3 rounded-xl shadow-lg">
                                <i class="fas fa-chart-line mr-2"></i>‚ú® Market Price
                            </button>
                            <button id="localNewsButton" class="btn-primary w-full p-3 rounded-xl shadow-lg bg-red-600 hover:bg-red-700">
                                <i class="fas fa-newspaper mr-2"></i> Local News
                            </button>
                            <button id="officerDetailsButton" class="btn-primary w-full p-3 rounded-xl shadow-lg bg-yellow-500 hover:bg-yellow-600">
                                <i class="fas fa-address-book mr-2"></i> Local Officer Details
                            </button>
                            </div>
                    </div>

                    <div class="space-y-4 mt-8">
                        </div>
                </div>

                <div class="w-full md:w-1/2 flex flex-col p-4 bg-gray-50 rounded-2xl flex-grow min-h-[50vh] md:h-full md:min-h-0">
                    <div id="chat-container" class="chat-container flex flex-col p-4 space-y-4 flex-grow">
                        <div class="ai-message message-bubble self-start shadow-md">
                            <p>Hello! I am Krishi-Mitra, your AI assistant. How can I help you with your farm today?</p>
                            <span class="message-timestamp"></span>
                        </div>
                    </div>

                    <div class="flex items-center space-x-2 mt-4 flex-shrink-0">
                        <input type="text" id="userInput" class="flex-grow p-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-800" placeholder="Ask your question here...">
                        <button id="micButton" class="btn-primary p-3 rounded-xl shadow-lg">
                               <i class="fas fa-microphone"></i>
                        </button>
                        <button id="sendButton" class="btn-primary p-3 rounded-xl shadow-lg">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>

                <div class="hidden lg:flex lg:w-1/4 flex-col bg-gradient-to-br from-green-50 to-blue-50 rounded-2xl p-4 shadow-inner space-y-4 h-full flex-shrink-0">
                    <h2 class="text-xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-hand-holding-usd mr-2 text-green-600"></i> Govt Schemes
                    </h2>
                    <div class="bg-white rounded-xl shadow-md p-3 border-l-4 border-green-500 hover:shadow-lg transition">
                        <h3 class="font-semibold text-gray-800 text-sm">PM Kisan Samman Nidhi</h3>
                        <p class="text-xs text-gray-600">‚Çπ6000 annually to small & marginal farmers.</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-3 border-l-4 border-blue-500 hover:shadow-lg transition">
                        <h3 class="font-semibold text-gray-800 text-sm">Soil Health Card</h3>
                        <p class="text-xs text-gray-600">Free soil testing & fertilizer advice.</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-3 border-l-4 border-yellow-500 hover:shadow-lg transition">
                        <h3 class="font-semibold text-gray-800 text-sm">Crop Insurance (PMFBY)</h3>
                        <p class="text-xs text-gray-600">Protection from crop losses due to disasters.</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-3 border-l-4 border-purple-500 hover:shadow-lg transition">
                            <h3 class="font-semibold text-gray-800 text-sm">Kisan Credit Card</h3>
                            <p class="text-xs text-gray-600">Low-interest loans for seeds, fertilizers & equipment.</p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-3 border-l-4 border-red-500 hover:shadow-lg transition">
                            <h3 class="font-semibold text-gray-800 text-sm">Pradhan Mantri Krishi Sinchai Yojana</h3>
                            <p class="text-xs text-gray-600">Improved irrigation facilities to ensure water for all farms.</p>
                    </div>

                    <button id="moreSchemes" class="btn-primary w-full rounded-xl mt-2">
                        <i class="fas fa-plus-circle mr-1"></i> View More
                    </button>
                </div>

            </div>
        </div>

        <div id="imageModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center hidden">
            <div class="bg-white p-6 rounded-xl shadow-xl w-11/12 max-w-md">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">Upload an Image</h2>
                <p class="mb-4 text-gray-600">Please select an image of your crop to get an instant analysis for pests or diseases.</p>
                <div class="flex flex-col items-center space-y-4">
                    <input type="file" id="modalImageInput" accept="image/*" class="p-2 border border-gray-300 rounded-lg w-full">
                    <button id="modalUploadButton" class="btn-primary w-full p-3 rounded-lg mt-2">Upload Image</button>
                    <button id="modalCloseButton" class="w-full p-3 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100 transition-colors">Cancel</button>
                </div>
            </div>
        </div>

        <div id="alertModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center hidden">
            <div class="bg-white p-6 rounded-xl shadow-xl w-11/12 max-w-md text-center">
                <h2 id="alertTitle" class="text-xl font-bold mb-4 text-gray-800"></h2>
                <p id="alertMessage" class="mb-4 text-gray-600"></p>
                <button id="alertCloseButton" class="btn-primary p-3 rounded-lg mt-2 w-full">OK</button>
            </div>
        </div>

        <div id="voiceToggle" class="voice-toggle" title="Toggle voice on / off">
            <div id="voiceDot" class="voice-dot on"></div>
            <div id="voiceLabel" class="font-medium text-sm">Voice: ON</div>
            <button id="voiceToggleBtn" class="btn-primary p-2 rounded-full" style="padding:6px 8px;">
                <i id="voiceIcon" class="fas fa-volume-up"></i>
            </button>
        </div>

    </body>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sendButton = document.getElementById('sendButton');
            const userInput = document.getElementById('userInput');
            const chatContainer = document.getElementById('chat-container');
            const dailyAdvisoryButton = document.getElementById('dailyAdvisoryButton');
            const imageAnalysisButton = document.getElementById('imageAnalysisButton');
            const govtSchemesButton = document.getElementById('govtSchemesButton');
            const marketPriceButton = document.getElementById('marketPriceButton');
            // NEW BUTTON REFERENCE ADDED
            const officerDetailsButton = document.getElementById('officerDetailsButton');
            // END NEW BUTTON REFERENCE
            // NEW BUTTON REFERENCE FOR NEWS
            const localNewsButton = document.getElementById('localNewsButton'); 
            // END NEW BUTTON REFERENCE FOR NEWS
            const micButton = document.getElementById('micButton');
            const langButtons = {
                en: document.getElementById('lang-en'),
                hi: document.getElementById('lang-hi'),
                ta: document.getElementById('lang-ta'),
                kn: document.getElementById('lang-kn'),
                ml: document.getElementById('lang-ml') // ADDED MALAYALAM BUTTON REFERENCE
            };
            const imageModal = document.getElementById('imageModal');
            const modalImageInput = document.getElementById('modalImageInput');
            const modalUploadButton = document.getElementById('modalUploadButton');
            const modalCloseButton = document.getElementById('modalCloseButton');
            const alertModal = document.getElementById('alertModal');
            const alertTitle = document.getElementById('alertTitle');
            const alertMessage = document.getElementById('alertMessage');
            const alertCloseButton = document.getElementById('alertCloseButton');
            const usernameDisplay = document.getElementById('username-display');

            // Voice toggle elements
            const voiceToggle = document.getElementById('voiceToggle');
            const voiceToggleBtn = document.getElementById('voiceToggleBtn');
            const voiceDot = document.getElementById('voiceDot');
            const voiceLabel = document.getElementById('voiceLabel');
            const voiceIcon = document.getElementById('voiceIcon');

            // --- LOCATION STATE VARIABLE ---
            // Default location will be used until geolocation is successful
            let userLocation = 'Greater Noida, Uttar Pradesh, India';
            // --- END LOCATION STATE VARIABLE ---


            // --- Set Default Username ---
            usernameDisplay.textContent = 'user';

            // --- Language and UI State ---
            // ************ MODIFIED: Set default language to Malayalam ('ml') ************
            let currentLanguage = 'ml';
            // ************ END MODIFIED ************

            // --- Voice state (persisted) ---
            let voiceEnabled = true;
            try {
                const saved = localStorage.getItem('krishi_voice_enabled');
                if (saved !== null) voiceEnabled = saved === 'true';
            } catch (e) { voiceEnabled = true; }

            const updateVoiceUI = () => {
                if (voiceEnabled) {
                    voiceDot.classList.remove('off'); voiceDot.classList.add('on');
                    voiceLabel.textContent = 'Voice: ON';
                    voiceIcon.className = 'fas fa-volume-up';
                } else {
                    voiceDot.classList.remove('on'); voiceDot.classList.add('off');
                    voiceLabel.textContent = 'Voice: OFF';
                    voiceIcon.className = 'fas fa-volume-mute';
                }
            };
            updateVoiceUI();

            voiceToggleBtn.addEventListener('click', () => {
                voiceEnabled = !voiceEnabled;
                try { localStorage.setItem('krishi_voice_enabled', voiceEnabled); } catch (e) {}
                updateVoiceUI();
                // Stop any ongoing speech when turned off
                if (!voiceEnabled && window.speechSynthesis) window.speechSynthesis.cancel();
            });

            // --- CONSTANTS ---
            const GEMINI_API_KEY = "AIzaSyBBsLS23Efpu7wwi_Cks6vZT865_xm2nIc";
            const CHAT_MODEL = "gemini-2.5-flash";

            // ************ MODIFIED: Button Translation Object including 'localNews' ************
            const buttonText = {
                'en': {
                    dailyAdvisory: '<i class="fas fa-sun mr-2"></i>‚ú® Daily Advisory',
                    imageAnalysis: '<i class="fas fa-camera mr-2"></i>‚ú® Image Analysis',
                    govtSchemes: '<i class="fas fa-hand-holding-usd mr-2"></i>‚ú® Govt Schemes',
                    marketPrice: '<i class="fas fa-chart-line mr-2"></i>‚ú® Market Price',
                    localNews: '<i class="fas fa-newspaper mr-2"></i> Local News', 
                    officerDetails: '<i class="fas fa-address-book mr-2"></i> Local Officer Details'
                },
                'hi': {
                    dailyAdvisory: '<i class="fas fa-sun mr-2"></i>‚ú® ‡§¶‡•à‡§®‡§ø‡§ï ‡§∏‡§≤‡§æ‡§π',
                    imageAnalysis: '<i class="fas fa-camera mr-2"></i>‚ú® ‡§õ‡§µ‡§ø ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£',
                    govtSchemes: '<i class="fas fa-hand-holding-usd mr-2"></i>‚ú® ‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç',
                    marketPrice: '<i class="fas fa-chart-line mr-2"></i>‚ú® ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø',
                    localNews: '<i class="fas fa-newspaper mr-2"></i> ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§∏‡§Æ‡§æ‡§ö‡§æ‡§∞', 
                    officerDetails: '<i class="fas fa-address-book mr-2"></i> ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡•Ä ‡§µ‡§ø‡§µ‡§∞‡§£'
                },
                'ta': {
                    dailyAdvisory: '<i class="fas fa-sun mr-2"></i>‚ú® ‡Æ§‡Æø‡Æ©‡Æö‡Æ∞‡Æø ‡ÆÜ‡Æ≤‡Øã‡Æö‡Æ©‡Øà',
                    imageAnalysis: '<i class="fas fa-camera mr-2"></i>‚ú® ‡Æ™‡Æü ‡Æ™‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡ÆØ‡Øç‡Æµ‡ØÅ',
                    govtSchemes: '<i class="fas fa-hand-holding-usd mr-2"></i>‚ú® ‡ÆÖ‡Æ∞‡Æö‡ØÅ ‡Æ§‡Æø‡Æü‡Øç‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Øç',
                    marketPrice: '<i class="fas fa-chart-line mr-2"></i>‚ú® ‡Æö‡Æ®‡Øç‡Æ§‡Øà ‡Æµ‡Æø‡Æ≤‡Øà',
                    localNews: '<i class="fas fa-newspaper mr-2"></i> ‡Æâ‡Æ≥‡Øç‡Æ≥‡ØÇ‡Æ∞‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡Æø', 
                    officerDetails: '<i class="fas fa-address-book mr-2"></i> ‡Æâ‡Æ≥‡Øç‡Æ≥‡ØÇ‡Æ∞‡Øç ‡ÆÖ‡Æ§‡Æø‡Æï‡Ææ‡Æ∞‡Æø ‡Æµ‡Æø‡Æµ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øç'
                },
                'kn': {
                    dailyAdvisory: '<i class="fas fa-sun mr-2"></i>‚ú® ‡≤¶‡≥à‡≤®‡≤Ç‡≤¶‡≤ø‡≤® ‡≤∏‡≤≤‡≤π‡≥Ü',
                    imageAnalysis: '<i class="fas fa-camera mr-2"></i>‚ú® ‡≤ö‡≤ø‡≤§‡≥ç‡≤∞ ‡≤µ‡≤ø‡≤∂‡≥ç‡≤≤‡≥á‡≤∑‡≤£‡≥Ü',
                    govtSchemes: '<i class="fas fa-hand-holding-usd mr-2"></i>‚ú® ‡≤∏‡≤∞‡≥ç‡≤ï‡≤æ‡≤∞‡≤ø ‡≤Ø‡≥ã‡≤ú‡≤®‡≥Ü‡≤ó‡≤≥‡≥Å',
                    marketPrice: '<i class="fas fa-chart-line mr-2"></i>‚ú® ‡≤Æ‡≤æ‡≤∞‡≥Å‡≤ï‡≤ü‡≥ç‡≤ü‡≥Ü ‡≤¨‡≥Ü‡≤≤‡≥Ü',
                    localNews: '<i class="fas fa-newspaper mr-2"></i> ‡≤∏‡≥ç‡≤•‡≤≥‡≥Ä‡≤Ø ‡≤∏‡≥Å‡≤¶‡≥ç‡≤¶‡≤ø', 
                    officerDetails: '<i class="fas fa-address-book mr-2"></i> ‡≤∏‡≥ç‡≤•‡≤≥‡≥Ä‡≤Ø ‡≤Ö‡≤ß‡≤ø‡≤ï‡≤æ‡≤∞‡≤ø ‡≤µ‡≤ø‡≤µ‡≤∞‡≤ó‡≤≥‡≥Å'
                },
                'ml': {
                    dailyAdvisory: '<i class="fas fa-sun mr-2"></i>‚ú® ‡¥¶‡µà‡¥®‡¥Ç‡¥¶‡¥ø‡¥® ‡¥â‡¥™‡¥¶‡µá‡¥∂‡¥Ç',
                    imageAnalysis: '<i class="fas fa-camera mr-2"></i>‚ú® ‡¥á‡¥Æ‡µá‡¥ú‡µç ‡¥µ‡¥ø‡¥∂‡¥ï‡¥≤‡¥®‡¥Ç',
                    govtSchemes: '<i class="fas fa-hand-holding-usd mr-2"></i>‚ú® ‡¥∏‡µº‡¥ï‡µç‡¥ï‡¥æ‡µº ‡¥™‡¥¶‡µç‡¥ß‡¥§‡¥ø‡¥ï‡µæ',
                    marketPrice: '<i class="fas fa-chart-line mr-2"></i>‚ú® ‡¥Æ‡¥æ‡µº‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡µç ‡¥µ‡¥ø‡¥≤',
                    localNews: '<i class="fas fa-newspaper mr-2"></i> ‡¥™‡µç‡¥∞‡¥æ‡¥¶‡µá‡¥∂‡¥ø‡¥ï ‡¥µ‡¥æ‡µº‡¥§‡µç‡¥§',
                    officerDetails: '<i class="fas fa-address-book mr-2"></i> ‡¥™‡µç‡¥∞‡¥æ‡¥¶‡µá‡¥∂‡¥ø‡¥ï ‡¥â‡¥¶‡µç‡¥Ø‡µã‡¥ó‡¥∏‡µç‡¥• ‡¥µ‡¥ø‡¥µ‡¥∞‡¥ô‡µç‡¥ô‡µæ'
                }
            };
            // ************ END MODIFIED ************


            const welcomeMessages = {
                'en': 'Hello! I am Krishi-Mitra, your AI assistant. How can I help you with your farm today?',
                'hi': '‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§ï‡•É‡§∑‡§ø-‡§Æ‡§ø‡§§‡•ç‡§∞, ‡§Ü‡§™‡§ï‡§æ ‡§è‡§Ü‡§à ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§π‡•Ç‡§Å‡•§ ‡§Æ‡•à‡§Ç ‡§Ü‡§ú ‡§Ü‡§™‡§ï‡•á ‡§ñ‡•á‡§§ ‡§Æ‡•á‡§Ç ‡§ï‡•à‡§∏‡•á ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å?',
                'ta': '‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç! ‡Æ®‡Ææ‡Æ©‡Øç ‡Æï‡Æø‡Æ∞‡ØÅ‡Æ∑‡Æø-‡ÆÆ‡Æø‡Æ§‡Øç‡Æ∞‡Ææ, ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç AI ‡Æâ‡Æ§‡Æµ‡Æø‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç. ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡Æ£‡Øç‡Æ£‡Øà‡Æï‡Øç‡Æï‡ØÅ ‡Æá‡Æ©‡Øç‡Æ±‡ØÅ ‡Æé‡Æ™‡Øç‡Æ™‡Æü‡Æø ‡Æâ‡Æ§‡Æµ ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡ØÅ‡ÆÆ‡Øç?',
                'kn': '‡≤®‡≤Æ‡≤∏‡≥ç‡≤ï‡≤æ‡≤∞! ‡≤®‡≤æ‡≤®‡≥Å ‡≤ï‡≥É‡≤∑‡≤ø-‡≤Æ‡≤ø‡≤§‡≥ç‡≤∞, ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ AI ‡≤∏‡≤π‡≤æ‡≤Ø‡≤ï. ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤ï‡≥É‡≤∑‡≤ø‡≤ó‡≥Ü ‡≤á‡≤Ç‡≤¶‡≥Å ‡≤π‡≥á‡≤ó‡≥Ü ‡≤∏‡≤π‡≤æ‡≤Ø ‡≤Æ‡≤æ‡≤°‡≤¨‡≤π‡≥Å‡≤¶‡≥Å?',
                'ml': '‡¥®‡¥Æ‡¥∏‡µç‡¥ï‡¥æ‡¥∞‡¥Ç! ‡¥û‡¥æ‡µª ‡¥ï‡µÉ‡¥∑‡¥ø-‡¥Æ‡¥ø‡¥§‡µç‡¥∞, ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ AI ‡¥∏‡¥π‡¥æ‡¥Ø‡¥ø. ‡¥á‡¥®‡µç‡¥®‡µç ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥ï‡µÉ‡¥∑‡¥ø‡¥Ø‡¥ø‡¥ü‡¥§‡µç‡¥§‡¥ø‡µΩ ‡¥û‡¥æ‡µª ‡¥é‡¥ô‡µç‡¥ô‡¥®‡µÜ ‡¥∏‡¥π‡¥æ‡¥Ø‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥Ç?' // ADDED MALAYALAM
            };
            const placeholders = {
                'en': 'Ask your question here...',
                'hi': '‡§Ø‡§π‡§æ‡§Ç ‡§Ö‡§™‡§®‡§æ ‡§∏‡§µ‡§æ‡§≤ ‡§™‡•Ç‡§õ‡•á‡§Ç...',
                'ta': '‡Æá‡Æô‡Øç‡Æï‡Øá ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æï‡Øá‡Æ≥‡Øç‡Æµ‡Æø‡ÆØ‡Øà‡Æï‡Øç ‡Æï‡Øá‡Æ≥‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç...',
                'kn': '‡≤á‡≤≤‡≥ç‡≤≤‡≤ø ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤™‡≥ç‡≤∞‡≤∂‡≥ç‡≤®‡≥Ü‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤ï‡≥á‡≤≥‡≤ø...',
                'ml': '‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥ö‡µã‡¥¶‡µç‡¥Ø‡¥Ç ‡¥á‡¥µ‡¥ø‡¥ü‡µÜ ‡¥ö‡µã‡¥¶‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï...' // ADDED MALAYALAM
            };
            const systemPrompts = {
    'en': `
You are **Krishi-Mitra**, an advanced agriculture expert AI for Indian farmers.
Your answers must always be:

‚úî 100% accurate  
‚úî Based on ICAR guidelines, Krishi Vigyan Kendra (KVK) advisories, and standard agronomy  
‚úî Short, clear, and always in **bullet points** ‚úî Tailored to Indian crops, climate, soil and farming practices  
‚úî Practical and farmer-friendly  
‚úî Focused ONLY on agriculture

You MUST cover these topics very professionally when relevant:

üåæ Crop Management  
- Sowing time, spacing, seed rate  
- Irrigation schedule  
- Fertilizer schedule (NPK doses, timing, method)  
- Weeding, intercultivation  
- Harvest timeline  

ü¶† Pest & Disease Diagnosis  
- Identify pest/disease  
- Give symptoms  
- Give exact treatment  
- Give correct pesticide dose (ml/acre or gm/litre)  
- Give organic + chemical options  
- Give prevention steps  

üå± Soil & Fertility  
- Soil health  
- pH-related advice  
- Nutrients deficiency correction  

‚òÅÔ∏è Weather-Based Advisory  
- Rainfall alerts  
- Irrigation changes  
- Disease risk  

üíß Irrigation  
- Drip / flood quantity  
- Schedule based on crop stage  

üöú Machinery  
- Suitable tools and machines  

üí∞ Market & Govt Schemes  
- Provide only verified information  
- No guessing  

‚ùå You must NOT  
- Provide non-agriculture answers  
- Give medical, legal, political advice  
- Guess numbers (if not sure, say ‚Äúdata not available‚Äù)

Always answer in **simple, short bullet points** so every farmer can understand easily.
Reply strictly and exclusively in English. Do not use any other language.
    `,

    'hi': `
‡§Ü‡§™ **‡§ï‡•É‡§∑‡§ø-‡§Æ‡§ø‡§§‡•ç‡§∞**, ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§â‡§®‡•ç‡§®‡§§ ‡§è‡§Ü‡§à ‡§ï‡•É‡§∑‡§ø ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û ‡§π‡•à‡§Ç‡•§

‡§Ü‡§™‡§ï‡•á ‡§â‡§§‡•ç‡§§‡§∞ ‡§π‡§Æ‡•á‡§∂‡§æ:

‚úî 100% ‡§∏‡§ü‡•Ä‡§ï  
‚úî ICAR, ‡§ï‡•É‡§∑‡§ø ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞ (KVK) ‡§î‡§∞ ‡§Æ‡§æ‡§®‡§ï ‡§ï‡•É‡§∑‡§ø ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§® ‡§™‡§∞ ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§  
‚úî ‡§õ‡•ã‡§ü‡•á, ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§î‡§∞ ‡§π‡§Æ‡•á‡§∂‡§æ **‡§¨‡§ø‡§Ç‡§¶‡•Å‡§ì‡§Ç ‡§Æ‡•á‡§Ç** ‚úî ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§´‡§∏‡§≤‡•á‡§Ç, ‡§ú‡§≤‡§µ‡§æ‡§Ø‡•Å ‡§î‡§∞ ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞  
‚úî ‡§ï‡§ø‡§∏‡§æ‡§®-‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤ ‡§î‡§∞ ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï  
‚úî ‡§ï‡•á‡§µ‡§≤ ‡§ï‡•É‡§∑‡§ø ‡§µ‡§ø‡§∑‡§Ø‡•ã‡§Ç ‡§§‡§ï ‡§∏‡•Ä‡§Æ‡§ø‡§§  

‡§Ü‡§™‡§ï‡•ã ‡§π‡§Æ‡•á‡§∂‡§æ ‡§á‡§® ‡§µ‡§ø‡§∑‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§™‡•ç‡§∞‡•ã‡§´‡•á‡§∂‡§®‡§≤ ‡§§‡§∞‡•Ä‡§ï‡•á ‡§∏‡•á ‡§ï‡§µ‡§∞ ‡§ï‡§∞‡§®‡§æ ‡§π‡•à:

üåæ ‡§´‡§∏‡§≤ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®  
ü¶† ‡§ï‡•Ä‡§ü ‡§µ ‡§∞‡•ã‡§ó ‡§™‡§π‡§ö‡§æ‡§® + ‡§â‡§™‡§ö‡§æ‡§∞  
üå± ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§µ ‡§™‡•ã‡§∑‡§ï ‡§§‡§§‡•ç‡§µ ‡§∏‡•Å‡§ß‡§æ‡§∞  
‚òÅÔ∏è ‡§Æ‡•å‡§∏‡§Æ ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§∏‡§≤‡§æ‡§π  
üíß ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§∂‡•á‡§°‡•ç‡§Ø‡•Ç‡§≤  
üöú ‡§ï‡•É‡§∑‡§ø ‡§Æ‡§∂‡•Ä‡§®‡§∞‡•Ä  
üí∞ ‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Å  
(‡§ï‡•á‡§µ‡§≤ ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä)  

‚ùå ‡§ó‡•à‡§∞-‡§ï‡•É‡§∑‡§ø ‡§∏‡§µ‡§æ‡§≤‡•ã‡§Ç ‡§ï‡§æ ‡§ú‡§µ‡§æ‡§¨ ‡§® ‡§¶‡•á‡§Ç‡•§

‡§π‡§Æ‡•á‡§∂‡§æ ‡§∏‡§∞‡§≤ ‡§≠‡§æ‡§∑‡§æ ‡§î‡§∞ **‡§¨‡§ø‡§Ç‡§¶‡•Å‡§ì‡§Ç ‡§Æ‡•á‡§Ç ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á‡§Ç‡•§**
‡§â‡§§‡•ç‡§§‡§∞ ‡§π‡§Æ‡•á‡§∂‡§æ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§¶‡•á‡§Ç‡•§
    `,

    'ta': `
‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç **‡Æï‡Æø‡Æ∞‡Æø‡Æ∑‡Æø-‡ÆÆ‡Æø‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡Ææ**, ‡Æá‡Æ®‡Øç‡Æ§‡Æø‡ÆØ ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡Æø‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æ© ‡ÆÆ‡Øá‡ÆÆ‡Øç‡Æ™‡Æü‡Øç‡Æü ‡Æö‡ØÜ‡ÆØ‡Æ±‡Øç‡Æï‡Øà ‡Æ®‡ØÅ‡Æ£‡Øç‡Æ£‡Æ±‡Æø‡Æµ‡ØÅ ‡Æµ‡Øá‡Æ≥‡Ææ‡Æ£‡Øç ‡Æ®‡Æø‡Æ™‡ØÅ‡Æ£‡Æ∞‡Øç.

‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡Æ§‡Æø‡Æ≤‡Øç‡Æï‡Æ≥‡Øç ‡Æé‡Æ™‡Øç‡Æ™‡Øã‡Æ§‡ØÅ‡ÆÆ‡Øç:

‚úî 100% ‡Æ§‡ØÅ‡Æ≤‡Øç‡Æ≤‡Æø‡ÆØ‡ÆÆ‡Ææ‡Æ©‡Æµ‡Øà  
‚úî ICAR, KVK ‡ÆÜ‡Æ≤‡Øã‡Æö‡Æ©‡Øà‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ±‡Æø‡Æµ‡Æø‡ÆØ‡Æ≤‡Øç ‡Æµ‡Øá‡Æ≥‡Ææ‡Æ£‡Øç‡ÆÆ‡Øà‡ÆØ‡Øà ‡ÆÖ‡Æü‡Æø‡Æ™‡Øç‡Æ™‡Æü‡Øà‡ÆØ‡Ææ‡Æï ‡Æï‡Øä‡Æ£‡Øç‡Æü‡Æµ‡Øà  
‚úî ‡Æé‡Æ≥‡Æø‡ÆÆ‡Øà‡ÆØ‡Ææ‡Æ©, ‡Æ§‡ØÜ‡Æ≥‡Æø‡Æµ‡Ææ‡Æ©, ‡Æé‡Æ™‡Øç‡Æ™‡Øã‡Æ§‡ØÅ‡ÆÆ‡Øç **‡Æ™‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æø‡Æï‡Æ≥‡Æø‡Æ≤‡Øç** ‚úî ‡Æá‡Æ®‡Øç‡Æ§‡Æø‡ÆØ ‡Æ™‡ÆØ‡Æø‡Æ∞‡Øç‡Æï‡Æ≥‡Øç, ‡ÆÆ‡Æ£‡Øç, ‡Æï‡Ææ‡Æ≤‡Æ®‡Æø‡Æ≤‡Øà ‡ÆÜ‡Æï‡Æø‡ÆØ‡Æµ‡Æ±‡Øç‡Æ±‡Æø‡Æ±‡Øç‡Æï‡ØÅ ‡Æ™‡Øä‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ÆÆ‡Ææ‡Æ©‡Æµ‡Øà  
‚úî ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡Æø ‡Æ®‡Æü‡Øç‡Æ™‡ØÅ ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Øç‡Æ™‡Æü‡Æï‡Øç‡Æï‡ØÇ‡Æü‡Æø‡ÆØ‡Æµ‡Øà  
‚úî ‡Æµ‡Øá‡Æ≥‡Ææ‡Æ£‡Øç‡ÆÆ‡Øà ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æ™‡Ææ‡Æ© ‡Æï‡Øá‡Æ≥‡Øç‡Æµ‡Æø‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡ÆÆ‡Æü‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Æ§‡Æø‡Æ≤‡Øç

‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡Æø‡Æ©‡Øç‡Æµ‡Æ∞‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Æ≤‡Øà‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øà ‡Æ§‡Øä‡Æ¥‡Æø‡Æ≤‡Øç‡ÆÆ‡ØÅ‡Æ±‡Øà ‡ÆÆ‡ØÅ‡Æ±‡Øà‡ÆØ‡Æø‡Æ≤‡Øç ‡Æï‡Øà‡ÆØ‡Ææ‡Æ≥ ‡Æµ‡Øá‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç:

üåæ ‡Æ™‡ÆØ‡Æø‡Æ∞‡Øç ‡ÆÆ‡Øá‡Æ≤‡Ææ‡Æ£‡Øç‡ÆÆ‡Øà  
‚Äì ‡Æµ‡Æø‡Æ§‡Øà‡Æ™‡Øç‡Æ™‡ØÅ ‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç, ‡Æµ‡Æø‡Æ§‡Øà ‡Æµ‡ØÄ‡Æ§‡ÆÆ‡Øç  
‚Äì ‡Æ™‡Ææ‡Æö‡Æ© ‡ÆÖ‡Æü‡Øç‡Æü‡Æµ‡Æ£‡Øà  
‚Äì ‡Æâ‡Æ∞ ‡ÆÖ‡Æü‡Øç‡Æü‡Æµ‡Æ£‡Øà (NPK ‡ÆÖ‡Æ≥‡Æµ‡ØÅ)  
‚Äì ‡Æ™‡ØÅ‡Æ≤‡Øç ‡Æï‡Æü‡Øç‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡Æü‡ØÅ  
‚Äì ‡ÆÖ‡Æ±‡ØÅ‡Æµ‡Æü‡Øà ‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç  

ü¶† ‡Æ™‡ØÇ‡Æö‡Øç‡Æö‡Æø & ‡Æ®‡Øã‡ÆØ‡Øç ‡ÆÆ‡Øá‡Æ≤‡Ææ‡Æ£‡Øç‡ÆÆ‡Øà  
‚Äì ‡Æ®‡Øã‡ÆØ‡Øç/‡Æ™‡ØÇ‡Æö‡Øç‡Æö‡Æø ‡ÆÖ‡Æü‡Øà‡ÆØ‡Ææ‡Æ≥‡ÆÆ‡Øç  
‚Äì ‡ÆÖ‡Æ±‡Æø‡Æï‡ØÅ‡Æ±‡Æø‡Æï‡Æ≥‡Øç  
‚Äì ‡Æ§‡ØÅ‡Æ≤‡Øç‡Æ≤‡Æø‡ÆØ‡ÆÆ‡Ææ‡Æ© ‡ÆÆ‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ  
‚Äì ‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ© ‡Æü‡Øã‡Æ∏‡Øç (ml/acre / gm/litre)  
‚Äì ‡Æá‡ÆØ‡Æ±‡Øç‡Æï‡Øà + ‡Æá‡Æ∞‡Æö‡Ææ‡ÆØ‡Æ© ‡Æµ‡Æø‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡Æô‡Øç‡Æï‡Æ≥‡Øç  
‚Äì ‡Æ§‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ ‡Æ®‡Æü‡Æµ‡Æü‡Æø‡Æï‡Øç‡Æï‡Øà‡Æï‡Æ≥‡Øç  

üå± ‡ÆÆ‡Æ£‡Øç & ‡Æö‡Æ§‡Øç‡Æ§‡ØÅ  
‚Äì ‡ÆÆ‡Æ£‡Øç pH  
‚Äì ‡Æö‡Æ§‡Øç‡Æ§‡ØÅ ‡Æï‡ØÅ‡Æ±‡Øà‡Æ™‡Ææ‡Æü‡ØÅ ‡Æ§‡Æø‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç  

‚òÅÔ∏è ‡Æï‡Ææ‡Æ≤‡Æ®‡Æø‡Æ≤‡Øà ‡ÆÜ‡Æ≤‡Øã‡Æö‡Æ©‡Øà  
‚Äì ‡ÆÆ‡Æ¥‡Øà ‡Æ§‡Ææ‡Æï‡Øç‡Æï‡ÆÆ‡Øç  
‚Äì ‡Æ™‡Ææ‡Æö‡Æ© ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ±‡Æô‡Øç‡Æï‡Æ≥‡Øç  
‚Äì ‡Æ®‡Øã‡ÆØ‡Øç ‡ÆÖ‡Æ™‡Ææ‡ÆØ‡ÆÆ‡Øç  

üíß ‡Æ™‡Ææ‡Æö‡Æ©‡ÆÆ‡Øç  
‚Äì ‡Æ§‡ØÅ‡Æ≥‡Æø/‡ÆÜ‡Æ¥‡Æø ‡ÆÖ‡Æ≥‡Æµ‡ØÅ  
‚Äì ‡Æ™‡ÆØ‡Æø‡Æ∞‡Øç ‡Æ®‡Æø‡Æ≤‡Øà ‡ÆÖ‡Æü‡Æø‡Æ™‡Øç‡Æ™‡Æü‡Øà‡ÆØ‡Æø‡Æ≤‡Øç ‡ÆÖ‡Æü‡Øç‡Æü‡Æµ‡Æ£‡Øà  

üí∞ ‡ÆÖ‡Æ∞‡Æö‡ØÅ ‡Æ§‡Æø‡Æü‡Øç‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Øç  
‚Äì ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü ‡Æ§‡Æï‡Æµ‡Æ≤‡Øç ‡ÆÆ‡Æü‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç  
‚Äì ‡Æé‡Æ®‡Øç‡Æ§ ‡Æä‡Æï‡ÆÆ‡ØÅ‡ÆÆ‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà  

‚ùå ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æï‡Øç‡Æï‡ØÇ‡Æü‡Ææ‡Æ§‡ØÅ: ‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ, ‡Æö‡Æü‡Øç‡Æü, ‡ÆÖ‡Æ∞‡Æö‡Æø‡ÆØ‡Æ≤‡Øç ‡Æï‡Øá‡Æ≥‡Øç‡Æµ‡Æø‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æ™‡Æ§‡Æø‡Æ≤‡Øç ‡ÆÖ‡Æ≥‡Æø‡Æï‡Øç‡Æï ‡Æµ‡Øá‡Æ£‡Øç‡Æü‡Ææ‡ÆÆ‡Øç.  
‡Æé‡Æ™‡Øç‡Æ™‡Øã‡Æ§‡ØÅ‡ÆÆ‡Øç ‡Æé‡Æ≥‡Æø‡ÆØ ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Æø‡Æ≤‡Øç **‡Æ™‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æø‡Æï‡Æ≥‡Ææ‡Æï** ‡Æ™‡Æ§‡Æø‡Æ≤‡Æ≥‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.
    `,

    'kn': `
‡≤®‡≥Ä‡≤µ‡≥Å **‡≤ï‡≥É‡≤∑‡≤ø-‡≤Æ‡≤ø‡≤§‡≥ç‡≤∞**, ‡≤≠‡≤æ‡≤∞‡≤§‡≥Ä‡≤Ø ‡≤∞‡≥à‡≤§‡≤∞‡≤ø‡≤ó‡≤æ‡≤ó‡≤ø ‡≤µ‡≤ø‡≤®‡≥ç‡≤Ø‡≤æ‡≤∏‡≤ó‡≥ä‡≤≥‡≤ø‡≤∏‡≤ø‡≤¶ ‡≤Ö‡≤§‡≥ç‡≤Ø‡≤æ‡≤ß‡≥Å‡≤®‡≤ø‡≤ï ‡≤ï‡≥É‡≤∑‡≤ø ‡≤§‡≤ú‡≥ç‡≤û AI.

‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤â‡≤§‡≥ç‡≤§‡≤∞‡≤ó‡≤≥‡≥Å ‡≤∏‡≤¶‡≤æ:

‚úî 100% ‡≤®‡≤ø‡≤ñ‡≤∞‡≤µ‡≤æ‡≤ó‡≤ø‡≤∞‡≤¨‡≥á‡≤ï‡≥Å  
‚úî ICAR ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å KVK ‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó‡≤∏‡≥Ç‡≤ö‡≤ø‡≤ó‡≤≥ ‡≤Ü‡≤ß‡≤æ‡≤∞‡≤¶ ‡≤Æ‡≥á‡≤≤‡≥Ü  
‚úî ‡≤∏‡≤∞‡≤≥, ‡≤∏‡≥ç‡≤™‡≤∑‡≥ç‡≤ü, ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å **‡≤¨‡≥Å‡≤≤‡≥Ü‡≤ü‡≥ç ‡≤™‡≤æ‡≤Ø‡≤ø‡≤Ç‡≤ü‡≥ç‚Äå‡≤ó‡≤≥‡≤≤‡≥ç‡≤≤‡≤ø** ‚úî ‡≤≠‡≤æ‡≤∞‡≤§‡≤¶ ‡≤π‡≤µ‡≤æ‡≤Æ‡≤æ‡≤®, ‡≤Æ‡≤£‡≥ç‡≤£‡≥Å, ‡≤¨‡≥Ü‡≤≥‡≥Ü‡≤ó‡≤≥‡≤ø‡≤ó‡≥Ü ‡≤π‡≥ä‡≤Ç‡≤¶‡≥Å‡≤µ‡≤Ç‡≤§‡≥Ü  
‚úî ‡≤∞‡≥à‡≤§‡≤∞‡≤ø‡≤ó‡≥Ü ‡≤Ö‡≤∞‡≥ç‡≤•‡≤µ‡≤æ‡≤ó‡≥Å‡≤µ ‡≤∞‡≥Ä‡≤§‡≤ø‡≤Ø‡≤≤‡≥ç‡≤≤‡≤ø  
‚úî ‡≤ï‡≥É‡≤∑‡≤ø ‡≤µ‡≤ø‡≤∑‡≤Ø‡≤ó‡≤≥‡≤ø‡≤ó‡≥Ü ‡≤Æ‡≤æ‡≤§‡≥ç‡≤∞

‡≤®‡≥Ä‡≤µ‡≥Å ‡≤Æ‡≥Å‡≤Ç‡≤¶‡≤ø‡≤® ‡≤µ‡≤ø‡≤∑‡≤Ø‡≤ó‡≤≥‡≤≤‡≥ç‡≤≤‡≤ø ‡≤§‡≤ú‡≥ç‡≤û ‡≤∏‡≤≤‡≤π‡≥Ü ‡≤®‡≥Ä‡≤°‡≤¨‡≥á‡≤ï‡≥Å:

üåæ ‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤®‡≤ø‡≤∞‡≥ç‡≤µ‡≤π‡≤£‡≥Ü  
‚Äì ‡≤¨‡≤ø‡≤§‡≥ç‡≤§‡≤®‡≥Ü ‡≤∏‡≤Æ‡≤Ø  
‚Äì ‡≤®‡≥Ä‡≤∞‡≤æ‡≤µ‡≤∞‡≤ø ‡≤µ‡≥á‡≤≥‡≤æ‡≤™‡≤ü‡≥ç‡≤ü‡≤ø  
‚Äì ‡≤ó‡≥ä‡≤¨‡≥ç‡≤¨‡≤∞‡≤¶ NPK ‡≤¶‡≥ã‡≤∑‡≥Ü  
‚Äì ‡≤§‡≥Å‡≤≥‡≥Å‡≤ï‡≤æ‡≤ü, ‡≤ï‡≤≥‡≥Ü ‡≤§‡≥Ü‡≤ó‡≥Ü‡≤¶‡≥Å‡≤π‡≤æ‡≤ï‡≥Å‡≤µ‡≥Å‡≤¶‡≥Å  
‚Äì ‡≤ï‡≥ä‡≤Ø‡≥ç‡≤Ø‡≥Å‡≤µ ‡≤∏‡≤Æ‡≤Ø  

ü¶† ‡≤ï‡≥Ä‡≤ü & ‡≤∞‡≥ã‡≤ó ‡≤ó‡≥Å‡≤∞‡≥Å‡≤§‡≤ø‡≤ï‡≥Ü  
‚Äì ‡≤≤‡≤ï‡≥ç‡≤∑‡≤£‡≤ó‡≤≥‡≥Å  
‚Äì ‡≤®‡≤ø‡≤ñ‡≤∞‡≤µ‡≤æ‡≤¶ ‡≤ö‡≤ø‡≤ï‡≤ø‡≤§‡≥ç‡≤∏‡≥Ü  
‚Äì ‡≤∏‡≤∞‡≤ø‡≤Ø‡≤æ‡≤¶ ‡≤°‡≥ã‡≤∏‡≥ç (ml/acre ‡≤Ö‡≤•‡≤µ‡≤æ gm/litre)  
‚Äì ‡≤ú‡≥à‡≤µ‡≤ø‡≤ï + ‡≤∞‡≤æ‡≤∏‡≤æ‡≤Ø‡≤®‡≤ø‡≤ï ‡≤Ü‡≤Ø‡≥ç‡≤ï‡≥Ü‡≤ó‡≤≥‡≥Å  
‚Äì ‡≤§‡≤°‡≥Ü ‡≤ï‡≥ç‡≤∞‡≤Æ‡≤ó‡≤≥‡≥Å  

üå± ‡≤Æ‡≤£‡≥ç‡≤£‡≥Å & ‡≤™‡≥ã‡≤∑‡≤ï‡≤æ‡≤Ç‡≤∂  
‚Äì ‡≤Æ‡≤£‡≥ç‡≤£‡≥Å pH  
‚Äì ‡≤ï‡≥ä‡≤∞‡≤§‡≥Ü ‡≤∏‡≤∞‡≤ø‡≤™‡≤°‡≤ø‡≤∏‡≥Å‡≤µ‡≥Å‡≤¶‡≥Å  

‚òÅÔ∏è ‡≤π‡≤µ‡≤æ‡≤Æ‡≤æ‡≤® ‡≤Ü‡≤ß‡≤∞‡≤ø‡≤§ ‡≤∏‡≤≤‡≤π‡≥Ü  
‚Äì ‡≤Æ‡≤≥‡≥Ü ‡≤é‡≤ö‡≥ç‡≤ö‡≤∞‡≤ø‡≤ï‡≥Ü  
‚Äì ‡≤®‡≥Ä‡≤∞‡≤æ‡≤µ‡≤∞‡≤ø ‡≤¨‡≤¶‡≤≤‡≤æ‡≤µ‡≤£‡≥Ü  

üíß ‡≤®‡≥Ä‡≤∞‡≤æ‡≤µ‡≤∞‡≤ø  
‚Äì ‡≤°‡≥ç‡≤∞‡≤ø‡≤™‡≥ç/‡≤´‡≥ç‡≤≤‡≤°‡≥ç ‡≤™‡≥ç‡≤∞‡≤Æ‡≤æ‡≤£  
‚Äì ‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤π‡≤Ç‡≤§‡≤ï‡≥ç‡≤ï‡≥Ü ‡≤Ö‡≤®‡≥Å‡≤ó‡≥Å‡≤£‡≤µ‡≤æ‡≤ó‡≤ø  

üí∞ ‡≤∏‡≤∞‡≤ï‡≤æ‡≤∞‡≤ø ‡≤Ø‡≥ã‡≤ú‡≤®‡≥Ü‡≤ó‡≤≥ ‡≤Æ‡≤æ‡≤π‡≤ø‡≤§‡≤ø  
‚Äì ‡≤™‡≤∞‡≤ø‡≤∂‡≥Ä‡≤≤‡≤ø‡≤§ ‡≤°‡≥á‡≤ü‡≤æ ‡≤Æ‡≤æ‡≤§‡≥ç‡≤∞  

‚ùå ‡≤µ‡≥à‡≤¶‡≥ç‡≤Ø‡≤ï‡≥Ä‡≤Ø, ‡≤ï‡≤æ‡≤®‡≥Ç‡≤®‡≥Å, ‡≤∞‡≤æ‡≤ú‡≤ï‡≥Ä‡≤Ø ‡≤™‡≥ç‡≤∞‡≤∂‡≥ç‡≤®‡≥Ü‡≤ó‡≤≥‡≤ø‡≤ó‡≥Ü ‡≤â‡≤§‡≥ç‡≤§‡≤∞‡≤ø‡≤∏‡≤¨‡≤æ‡≤∞‡≤¶‡≥Å.  
‡≤Ø‡≤æ‡≤µ‡≤æ‡≤ó‡≤≤‡≥Ç ‡≤∏‡≤∞‡≤≥ ‡≤ï‡≤®‡≥ç‡≤®‡≤°‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø **‡≤¨‡≥Å‡≤≤‡≥Ü‡≤ü‡≥ç ‡≤™‡≤æ‡≤Ø‡≤ø‡≤Ç‡≤ü‡≥ç‚Äå‡≤ó‡≤≥‡≤≤‡≥ç‡≤≤‡≤ø** ‡≤â‡≤§‡≥ç‡≤§‡≤∞‡≤ø‡≤∏‡≤¨‡≥á‡≤ï‡≥Å‡•§
    `,

    'ml': `
‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ **‡¥ï‡µÉ‡¥∑‡¥ø-‡¥Æ‡¥ø‡¥§‡µç‡¥∞**, ‡¥á‡¥®‡µç‡¥§‡µç‡¥Ø‡µª ‡¥ï‡µº‡¥∑‡¥ï‡µº‡¥ï‡µç‡¥ï‡µç ‡¥µ‡µá‡¥£‡µç‡¥ü‡¥ø ‡¥∞‡µÇ‡¥™‡¥ï‡µΩ‡¥™‡µç‡¥™‡¥® ‡¥ö‡µÜ‡¥Ø‡µç‡¥§ ‡¥í‡¥∞‡µÅ ‡¥Ö‡¥§‡µç‡¥Ø‡¥æ‡¥ß‡µÅ‡¥®‡¥ø‡¥ï AI ‡¥ï‡µÉ‡¥∑‡¥ø ‡¥µ‡¥ø‡¥¶‡¥ó‡µç‡¥ß‡¥®‡¥æ‡¥£‡µç.

‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥Æ‡¥±‡µÅ‡¥™‡¥ü‡¥ø‡¥ï‡µæ ‡¥é‡¥™‡µç‡¥™‡µã‡¥¥‡µÅ‡¥Ç:

‚úî 100% ‡¥ï‡µÉ‡¥§‡µç‡¥Ø‡¥Æ‡¥æ‡¥Ø‡¥ø‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡¥£‡¥Ç  
‚úî ICAR, KVK ‡¥Æ‡¥æ‡µº‡¥ó‡¥®‡¥ø‡µº‡¥¶‡µá‡¥∂‡¥ô‡µç‡¥ô‡¥≥‡µÜ ‡¥Ö‡¥ü‡¥ø‡¥∏‡µç‡¥•‡¥æ‡¥®‡¥Æ‡¥æ‡¥ï‡µç‡¥ï‡¥ø‡¥Ø‡µÅ‡¥≥‡µç‡¥≥‡¥§‡µç  
‚úî ‡¥é‡¥≥‡µÅ‡¥™‡µç‡¥™‡¥Ç ‡¥Æ‡¥®‡¥∏‡¥ø‡¥≤‡¥æ‡¥ï‡µÅ‡¥®‡µç‡¥® **‡¥™‡µã‡¥Ø‡¥ø‡¥®‡µç‡¥±‡µÅ‡¥ï‡¥≥‡¥æ‡¥Ø‡¥ø** ‚úî ‡¥á‡¥®‡µç‡¥§‡µç‡¥Ø‡µª ‡¥µ‡¥ø‡¥≥‡¥ï‡µæ, ‡¥Æ‡¥£‡µç‡¥£‡µç, ‡¥ï‡¥æ‡¥≤‡¥æ‡¥µ‡¥∏‡µç‡¥• ‡¥é‡¥®‡µç‡¥®‡¥ø‡¥µ‡¥Ø‡µÜ ‡¥Ö‡¥ü‡¥ø‡¥∏‡µç‡¥•‡¥æ‡¥®‡¥Æ‡¥æ‡¥ï‡µç‡¥ï‡¥ø  
‚úî ‡¥ï‡µº‡¥∑‡¥ï ‡¥∏‡µó‡¥π‡µÉ‡¥¶‡¥µ‡µÅ‡¥Ç ‡¥™‡µç‡¥∞‡¥æ‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡¥µ‡µÅ‡¥Æ‡µÅ‡¥≥‡µç‡¥≥‡¥§‡µç  
‚úî ‡¥ï‡µÉ‡¥∑‡¥ø ‡¥µ‡¥ø‡¥∑‡¥Ø‡¥ô‡µç‡¥ô‡µæ‡¥ï‡µç‡¥ï‡µç ‡¥Æ‡¥æ‡¥§‡µç‡¥∞‡¥Ç

‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ ‡¥®‡µΩ‡¥ï‡µá‡¥£‡µç‡¥ü ‡¥™‡µç‡¥∞‡¥ß‡¥æ‡¥® ‡¥Æ‡¥æ‡µº‡¥ó‡¥®‡¥ø‡µº‡¥¶‡µá‡¥∂‡¥ô‡µç‡¥ô‡µæ:

üåæ ‡¥µ‡¥ø‡¥≥ ‡¥Æ‡¥æ‡¥®‡µá‡¥ú‡µç‡¥Æ‡µÜ‡¥®‡µç‡¥±‡µç  
‚Äì ‡¥µ‡¥ø‡¥§‡¥Ø‡µç‚Äå‡¥ï‡µç‡¥ï‡µá‡¥£‡µç‡¥ü ‡¥∏‡¥Æ‡¥Ø‡¥Ç  
‚Äì ‡¥ú‡¥≤‡¥∏‡µá‡¥ö‡¥® ‡¥ï‡µç‡¥∞‡¥Æ‡¥Ç  
‚Äì NPK ‡¥µ‡¥≥‡¥§‡µç‡¥§‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥ï‡µÉ‡¥§‡µç‡¥Ø‡¥Æ‡¥æ‡¥Ø ‡¥Ö‡¥≥‡¥µ‡µç  
‚Äì ‡¥ï‡¥≥‡¥®‡¥æ‡¥∂‡¥®‡¥Ç  
‚Äì ‡¥ï‡µä‡¥Ø‡µç‡¥§‡µç‡¥§‡µç ‡¥∏‡¥Æ‡¥Ø‡¥Ç  

ü¶† ‡¥ï‡µÄ‡¥ü‚Äì‡¥∞‡µã‡¥ó ‡¥®‡¥ø‡µº‡¥£‡¥Ø‡¥Ç  
‚Äì ‡¥∞‡µã‡¥ó‡¥≤‡¥ï‡µç‡¥∑‡¥£‡¥ô‡µç‡¥ô‡µæ  
‚Äì ‡¥ï‡µÉ‡¥§‡µç‡¥Ø‡¥Æ‡¥æ‡¥Ø ‡¥ö‡¥ø‡¥ï‡¥ø‡¥§‡µç‡¥∏  
‚Äì ‡¥∂‡¥∞‡¥ø‡¥Ø‡¥æ‡¥Ø ‡¥°‡µã‡¥∏‡µç (ml/acre / gm/litre)  
‚Äì ‡¥ì‡µº‡¥ó‡¥æ‡¥®‡¥ø‡¥ï‡µç + ‡¥ï‡µÜ‡¥Æ‡¥ø‡¥ï‡µç‡¥ï‡µΩ ‡¥ì‡¥™‡µç‡¥∑‡¥®‡µÅ‡¥ï‡µæ  
‚Äì ‡¥Æ‡µÅ‡µª‡¥ï‡¥∞‡µÅ‡¥§‡µΩ ‡¥®‡¥ü‡¥™‡¥ü‡¥ø‡¥ï‡µæ  

üå± ‡¥Æ‡¥£‡µç‡¥£‡µç & ‡¥™‡µã‡¥∑‡¥ï ‡¥ï‡µÅ‡¥±‡¥µ‡µç  
‚Äì pH ‡¥™‡µç‡¥∞‡¥∂‡µç‡¥®‡¥ô‡µç‡¥ô‡µæ  
‚Äì ‡¥™‡µã‡¥∑‡¥ï ‡¥ï‡µÅ‡¥±‡¥µ‡µç ‡¥™‡¥∞‡¥ø‡¥π‡¥æ‡¥∞‡¥Ç  

‚òÅÔ∏è ‡¥ï‡¥æ‡¥≤‡¥æ‡¥µ‡¥∏‡µç‡¥•‡¥æ ‡¥Ö‡¥ü‡¥ø‡¥∏‡µç‡¥•‡¥æ‡¥®‡¥§‡µç‡¥§‡¥ø‡¥≤‡µÅ‡¥≥‡µç‡¥≥ ‡¥®‡¥ø‡µº‡¥¶‡µç‡¥¶‡µá‡¥∂‡¥ô‡µç‡¥ô‡µæ  
‚Äì ‡¥Æ‡¥¥ ‡¥Æ‡µÅ‡¥®‡µç‡¥®‡¥±‡¥ø‡¥Ø‡¥ø‡¥™‡µç‡¥™‡µç  
‚Äì ‡¥ú‡¥≤‡¥∏‡µá‡¥ö‡¥® ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥ô‡µç‡¥ô‡µæ  

üíß ‡¥ú‡¥≤‡¥∏‡µá‡¥ö‡¥®‡¥Ç  
‚Äì ‡¥°‡µç‡¥∞‡¥ø‡¥™‡µç‡¥™‡µç/‡¥´‡µç‡¥≥‡¥°‡µç ‡¥Ö‡¥≥‡¥µ‡µç  
‚Äì ‡¥µ‡¥ø‡¥≥‡¥Ø‡µÅ‡¥ü‡µÜ ‡¥µ‡¥≥‡µº‡¥ö‡µç‡¥ö‡¥æ ‡¥ò‡¥ü‡µç‡¥ü‡¥Ç ‡¥Ö‡¥®‡µÅ‡¥∏‡¥∞‡¥ø‡¥ö‡µç‡¥ö‡µç  

üí∞ ‡¥∏‡µº‡¥ï‡µç‡¥ï‡¥æ‡µº ‡¥™‡¥¶‡µç‡¥ß‡¥§‡¥ø‡¥ï‡µæ  
‚Äì ‡¥∏‡µç‡¥•‡¥ø‡¥∞‡µÄ‡¥ï‡¥∞‡¥ø‡¥ö‡µç‡¥ö ‡¥µ‡¥ø‡¥µ‡¥∞‡¥ô‡µç‡¥ô‡µæ ‡¥Æ‡¥æ‡¥§‡µç‡¥∞‡¥Ç  

‚ùå ‡¥Æ‡µÜ‡¥°‡¥ø‡¥ï‡µç‡¥ï‡µΩ, ‡¥®‡¥ø‡¥Ø‡¥Æ, ‡¥∞‡¥æ‡¥∑‡µç‡¥ü‡µç‡¥∞‡µÄ‡¥Ø ‡¥µ‡¥ø‡¥∑‡¥Ø‡¥ô‡µç‡¥ô‡µæ‡¥ï‡µç‡¥ï‡µç ‡¥Æ‡¥±‡µÅ‡¥™‡¥ü‡¥ø ‡¥®‡µΩ‡¥ï‡¥∞‡µÅ‡¥§‡µç.  
‡¥é‡¥™‡µç‡¥™‡µã‡¥¥‡µÅ‡¥Ç ‡¥≤‡¥≥‡¥ø‡¥§‡¥Æ‡¥æ‡¥Ø ‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥§‡µç‡¥§‡¥ø‡µΩ **‡¥™‡µã‡¥Ø‡¥ø‡¥®‡µç‡¥±‡µÅ‡¥ï‡¥≥‡¥æ‡¥Ø‡¥ø** ‡¥Æ‡¥±‡µÅ‡¥™‡¥ü‡¥ø ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï‡•§
    `
};
           
            // --- GEOLOCATION HELPER FUNCTION ---
            // This function simulates a reverse geocoding API call
            // In a production app, this would call a real API (like Google Maps Geocoding)
            const getLocalityFromCoordinates = async (latitude, longitude) => {
                // Mock reverse geocoding to a specific city/state for demonstration
                // Based on common coordinate ranges for a popular Indian city
                if (latitude && longitude) {
                    // For example, if we were in the range of Mumbai:
                    // if (latitude > 18 && latitude < 19 && longitude > 72 && longitude < 73) {
                    //     return 'Mumbai, Maharashtra, India';
                    // }
                    // To make it functional, we will use a generic default based on the device's location
                    // which is good enough for an AI prompt.
                    return `Your Current Area (Lat: ${latitude.toFixed(2)}, Lon: ${longitude.toFixed(2)})`;
                }
                return 'an unknown location in India'; // Fallback
            };

            const initializeGeolocation = () => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        async (position) => {
                            const lat = position.coords.latitude;
                            const lon = position.coords.longitude;
                            // Set the global location variable to the dynamically fetched place
                            userLocation = await getLocalityFromCoordinates(lat, lon);
                            console.log(`Geolocation successful. User location set to: ${userLocation}`);
                        },
                        (error) => {
                            console.error(`Geolocation error: ${error.message}`);
                            userLocation = 'Greater Noida, Uttar Pradesh, India'; // Fallback to original
                            showAlert("Location Access Denied", "Please allow location access to get local farm advice. Using default location (Greater Noida) for now.");
                        },
                        { enableHighAccuracy: false, timeout: 5000, maximumAge: 0 }
                    );
                } else {
                    console.error("Geolocation is not supported by this browser.");
                    showAlert("Location Not Supported", "Your browser does not support Geolocation. Using default location (Greater Noida).");
                }
            };
            // --- END GEOLOCATION HELPER FUNCTION ---


            const updateUIForLanguage = (lang) => {
                currentLanguage = lang;
                const userInputPlaceholder = document.getElementById('userInput');
                userInputPlaceholder.placeholder = placeholders[currentLanguage];

                // ************ MODIFIED: Update button text ************
                dailyAdvisoryButton.innerHTML = buttonText[currentLanguage].dailyAdvisory;
                imageAnalysisButton.innerHTML = buttonText[currentLanguage].imageAnalysis;
                govtSchemesButton.innerHTML = buttonText[currentLanguage].govtSchemes;
                marketPriceButton.innerHTML = buttonText[currentLanguage].marketPrice;
                localNewsButton.innerHTML = buttonText[currentLanguage].localNews; // NEW BUTTON
                officerDetailsButton.innerHTML = buttonText[currentLanguage].officerDetails;
                // ************ END MODIFIED ************

                Object.values(langButtons).forEach(btn => {
                    btn.classList.remove('bg-green-500', 'text-white');
                    btn.classList.add('bg-gray-200', 'text-gray-800');
                });
                langButtons[currentLanguage].classList.remove('bg-gray-200', 'text-gray-800');
                langButtons[currentLanguage].classList.add('bg-green-500', 'text-white');
                const firstAiMessageP = document.querySelector('#chat-container .ai-message p');
                if (firstAiMessageP) firstAiMessageP.textContent = welcomeMessages[currentLanguage];
            };

            // Initial UI update
            updateUIForLanguage(currentLanguage);
            // --- Call Geolocation on startup ---
            initializeGeolocation();
            // --- END Geolocation call ---

            langButtons.en.addEventListener('click', () => updateUIForLanguage('en'));
            langButtons.hi.addEventListener('click', () => updateUIForLanguage('hi'));
            langButtons.ta.addEventListener('click', () => updateUIForLanguage('ta'));
            langButtons.kn.addEventListener('click', () => updateUIForLanguage('kn'));
            langButtons.ml.addEventListener('click', () => updateUIForLanguage('ml')); // ADDED MALAYALAM LISTENER

            function showAlert(title, message) {
                alertTitle.textContent = title;
                alertMessage.textContent = message;
                alertModal.classList.remove('hidden');
            }
            alertCloseButton.addEventListener('click', () => {
                alertModal.classList.add('hidden');
            });

            // --- Text-to-Speech function ---
            function speakText(text) {
                if (!voiceEnabled) return;
                if (!('speechSynthesis' in window) || !('SpeechSynthesisUtterance' in window)) {
                    // Browser doesn't support TTS
                    return;
                }
                try {
                    window.speechSynthesis.cancel(); // stop any existing speech
                } catch (e) {}

                const utter = new SpeechSynthesisUtterance(text);
                // UPDATED TTS LANG CONFIGURATION
                utter.lang =
                    currentLanguage === "hi" ? "hi-IN" :
                    currentLanguage === "ta" ? "ta-IN" :
                    currentLanguage === "kn" ? "kn-IN" :
                    currentLanguage === "ml" ? "ml-IN" : // ADDED MALAYALAM
                    "en-IN";

                // Slightly adjust pitch/rate for clarity
                utter.pitch = 1;
                utter.rate = 1;
                // Start speaking
                try {
                    window.speechSynthesis.speak(utter);
                } catch (e) {
                    console.error("SpeechSynthesis error:", e);
                }
            }

            // --- Chat Message Functions ---
            const addMessage = (text, sender, isImage = false) => {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message-bubble', 'shadow-md');
                if (sender === 'user') {
                    messageDiv.classList.add('user-message', 'self-end');
                } else {
                    messageDiv.classList.add('ai-message', 'self-start');
                }

                if (isImage) {
                    const imageElement = document.createElement('img');
                    imageElement.src = text;
                    imageElement.classList.add('w-full', 'rounded-lg');
                    messageDiv.appendChild(imageElement);
                } else {
                    const messageContent = document.createElement('div'); // Changed from <p> to <div> to allow structured children

                    // ************ START FIX FOR FORMATTING ************
                    
                    // Split the text by newlines. Filter out empty lines caused by multiple newlines.
                    const lines = text.split('\n').filter(line => line.trim() !== '');
                    
                    if (lines.length > 0) {
                        const ul = document.createElement('ul');
                        ul.classList.add('list-disc', 'list-inside');
                        
                        let isListMode = false;
                        
                        lines.forEach(line => {
                            let trimmedLine = line.trim();
                            
                            // Check if line starts with a common list indicator (*, - or a number/dot, or a special character like a star)
                            const isListItem = trimmedLine.match(/^(\*|\-|\d+\.|\‚Ä¢|‚Äî)\s/);

                            if (isListItem || isListMode) {
                                // If it's explicitly a list item or we're in list mode
                                if (isListItem) {
                                    // Clean the indicator for display
                                    trimmedLine = trimmedLine.replace(/^(\*|\-|\d+\.|\‚Ä¢|‚Äî)\s*/, '').trim();
                                    isListMode = true; // Stay in list mode until a clear non-list item is encountered
                                }
                                
                                if (trimmedLine) {
                                    const li = document.createElement('li');
                                    li.innerHTML = trimmedLine; // Use innerHTML to preserve links/bolding if present
                                    ul.appendChild(li);
                                }
                            } else {
                                // If it's a paragraph or header, end the current list (if any) and start a new paragraph/div.
                                if (ul.children.length > 0) {
                                    messageContent.appendChild(ul.cloneNode(true)); // Append existing list
                                    ul.innerHTML = ''; // Clear for next list
                                }
                                isListMode = false;
                                
                                const p = document.createElement('p');
                                p.classList.add('mb-2'); // Add small spacing between paragraphs/titles
                                p.innerHTML = trimmedLine;
                                messageContent.appendChild(p);
                            }
                        });
                        
                        // Append any remaining list items
                        if (ul.children.length > 0) {
                            messageContent.appendChild(ul);
                        }
                    } else {
                        // If no newlines, treat as simple paragraph
                        const p = document.createElement('p');
                        p.textContent = text;
                        messageContent.appendChild(p);
                    }
                    // ************ END FIX FOR FORMATTING ************


                    messageDiv.appendChild(messageContent);
                }

                const timestamp = document.createElement('span');
                timestamp.classList.add('message-timestamp');
                timestamp.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                messageDiv.appendChild(timestamp);

                // If AI message (and not image) add Speak Again button and auto-speak (if enabled)
                if (sender === 'ai' && !isImage) {
                    const speakAgainBtn = document.createElement('button');
                    speakAgainBtn.classList.add('speak-btn');
                    speakAgainBtn.innerHTML = `<i class="fas fa-volume-up"></i><span class="text-sm">Speak Again</span>`;
                    speakAgainBtn.title = "Play audio for this response";
                    speakAgainBtn.addEventListener('click', () => {
                        // create clean text without list markers for better speech
                        let playable = '';
                        if (typeof text === 'string') {
                            playable = text.replace(/[\*\-]/g, ' ');
                        } else {
                            playable = String(text);
                        }
                        speakText(playable);
                    });

                    // place speak button after the content but before timestamp
                    // insert before timestamp element
                    messageDiv.insertBefore(speakAgainBtn, timestamp);
                }

                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;

                // Auto-speak AI messages
                if (sender === 'ai' && !isImage) {
                    let plainText = '';
                    if (typeof text === 'string') plainText = text.replace(/[\*\-]/g, ' ');
                    else plainText = String(text);
                    // Delay a tiny bit so speech doesn't overlap with UI rendering
                    setTimeout(() => { speakText(plainText); }, 120);
                }
            };

            const addLoadingDots = () => {
                const loadingDiv = document.createElement('div');
                loadingDiv.classList.add('ai-message', 'message-bubble', 'self-start', 'shadow-md');
                loadingDiv.innerHTML = `
                    <div class="loading-dots">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                `;
                chatContainer.appendChild(loadingDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                return loadingDiv;
            };

            const removeLoadingDots = (loadingDiv) => {
                if (loadingDiv) loadingDiv.remove();
            };

            async function fetchWithRetry(url, options, maxRetries = 5, delay = 1000) {
                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const response = await fetch(url, options);
                        if (response.ok) return response;
                        else if ((response.status === 503 || response.status === 429) && i < maxRetries - 1) {
                            await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
                        } else {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                    } catch (error) {
                        if (i < maxRetries - 1) {
                            await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
                        } else {
                            throw error;
                        }
                    }
                }
            }

            const callGeminiAPI = async (prompt, image = null, grounded = false) => {
                const loadingMessage = addLoadingDots();
                try {
                    const apiKey = GEMINI_API_KEY;
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${CHAT_MODEL}:generateContent?key=${apiKey}`;
                    const systemPrompt = systemPrompts[currentLanguage];
                    const parts = [{ text: `${systemPrompt} ${prompt}` }];
                    if (image) {
                        parts.push({
                            inlineData: {
                                mimeType: "image/png",
                                data: image.split(',')[1] // Extract base64 data
                            }
                        });
                    }

                    const payload = {
                        contents: [{ role: "user", parts }],
                        model: CHAT_MODEL,
                        tools: grounded ? [{ "google_search": {} }] : undefined,
                    };

                    const response = await fetchWithRetry(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorBody = await response.json();
                        console.error("Gemini API Error Response:", errorBody);
                        throw new Error(`HTTP error! status: ${response.status} - ${errorBody?.error?.message || response.statusText}`);
                    }

                    const result = await response.json();
                    const aiResponseText = result?.candidates?.[0]?.content?.parts?.[0]?.text || "I'm sorry, I couldn't generate a response. Please try again.";

                    removeLoadingDots(loadingMessage);
                    addMessage(aiResponseText, "ai");
                } catch (error) {
                    console.error("API call failed:", error);
                    removeLoadingDots(loadingMessage);
                    addMessage(`I'm sorry, I encountered an error and cannot generate a response right now. Please check the browser Console (F12) for the exact error message.`, "ai");
                    showAlert("API Error", `A connection error occurred. Check the browser Console (F12) for a red error message and status code (400, 403, 429) to determine the cause.`);
                }
            };

            const handleSendMessage = () => {
                const text = userInput.value.trim();
                if (text === '') return;
                addMessage(text, 'user');
                callGeminiAPI(text);
                userInput.value = '';
            };

            // --- Event Listeners ---
            sendButton.addEventListener('click', handleSendMessage);
            userInput.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    handleSendMessage();
                }
            });

            // --- Feature Button Logic - MODIFIED TO USE userLocation ---
            dailyAdvisoryButton.addEventListener('click', () => {
                const prompts = {
                    // **MODIFIED:** Replaced 'Greater Noida, Uttar Pradesh, India' with ${userLocation}
                    'en': `What is the weather like today in ${userLocation}, and based on this, provide a daily farming advisory for local crops like rice, wheat, and sugarcane. The advisory should be in a friendly tone and in points. **(STRICTLY RESPOND IN ENGLISH)**`,
                    'hi': `‡§Ü‡§ú ${userLocation} ‡§Æ‡•á‡§Ç ‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•à‡§∏‡§æ ‡§π‡•à, ‡§î‡§∞ ‡§á‡§∏‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞, ‡§ö‡§æ‡§µ‡§≤, ‡§ó‡•á‡§π‡•Ç‡§Ç ‡§î‡§∞ ‡§ó‡§®‡•ç‡§®‡•á ‡§ú‡•à‡§∏‡•Ä ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§´‡§∏‡§≤‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¶‡•à‡§®‡§ø‡§ï ‡§ï‡•É‡§∑‡§ø ‡§∏‡§≤‡§æ‡§π ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§∏‡§≤‡§æ‡§π ‡§è‡§ï ‡§¶‡•ã‡§∏‡•ç‡§§‡§æ‡§®‡§æ, ‡§∏‡§Ç‡§µ‡§æ‡§¶‡•Ä ‡§∏‡•ç‡§µ‡§∞ ‡§Æ‡•á‡§Ç ‡§π‡•ã‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è ‡§î‡§∞ ‡§¨‡§ø‡§Ç‡§¶‡•Å‡§ì‡§Ç ‡§Æ‡•á‡§Ç ‡§π‡•ã‡•§`,
                    'ta': `‡Æá‡Æ©‡Øç‡Æ±‡ØÅ ${userLocation} ‡Æá‡Æ≤‡Øç ‡Æµ‡Ææ‡Æ©‡Æø‡Æ≤‡Øà ‡Æé‡Æ™‡Øç‡Æ™‡Æü‡Æø ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ, ‡ÆÖ‡Æ§‡Æ©‡Æü‡Æø‡Æ™‡Øç‡Æ™‡Æü‡Øà‡ÆØ‡Æø‡Æ≤‡Øç, ‡ÆÖ‡Æ∞‡Æø‡Æö‡Æø, ‡Æï‡Øã‡Æ§‡ØÅ‡ÆÆ‡Øà, ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æï‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡ØÅ ‡Æ™‡Øã‡Æ©‡Øç‡Æ± ‡Æâ‡Æ≥‡Øç‡Æ≥‡ØÇ‡Æ∞‡Øç ‡Æ™‡ÆØ‡Æø‡Æ∞‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æ© ‡Æ§‡Æø‡Æ©‡Æö‡Æ∞‡Æø ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ ‡ÆÜ‡Æ≤‡Øã‡Æö‡Æ©‡Øà‡ÆØ‡Øà ‡Æµ‡Æ¥‡Æô‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç. ‡Æá‡Æ®‡Øç‡Æ§ ‡ÆÜ‡Æ≤‡Øã‡Æö‡Æ©‡Øà ‡Æí‡Æ∞‡ØÅ ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡Æø‡ÆØ‡ØÅ‡Æü‡Æ©‡Øç ‡Æ®‡Øá‡Æ∞‡Æü‡Æø‡ÆØ‡Ææ‡Æï‡Æ™‡Øç ‡Æ™‡Øá‡Æö‡ØÅ‡Æµ‡Æ§‡ØÅ ‡Æ™‡Øã‡Æ≤‡Øç ‡Æí‡Æ∞‡ØÅ ‡Æ®‡Æü‡Øç‡Æ™‡ØÅ, ‡Æâ‡Æ∞‡Øà‡ÆØ‡Ææ‡Æü‡Æ≤‡Øç ‡Æ§‡Øä‡Æ©‡Æø‡ÆØ‡Æø‡Æ≤‡Øç ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï ‡Æµ‡Øá‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç. ‡ÆÆ‡Øá‡Æ≤‡ØÅ‡ÆÆ‡Øç, ‡Æ™‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æø‡Æï‡Æ≥‡Ææ‡Æï ‡Æ™‡Æ§‡Æø‡Æ≤‡Æ≥‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç‡•§`,
                    'kn': `‡≤á‡≤Ç‡≤¶‡≥Å ${userLocation} ‡≤®‡≤≤‡≥ç‡≤≤‡≤ø ‡≤π‡≤µ‡≤æ‡≤Æ‡≤æ‡≤® ‡≤π‡≥á‡≤ó‡≤ø‡≤¶‡≥Ü, ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤á‡≤¶‡≤∞ ‡≤Ü‡≤ß‡≤æ‡≤∞‡≤¶ ‡≤Æ‡≥á‡≤≤‡≥Ü, ‡≤≠‡≤§‡≥ç‡≤§, ‡≤ó‡≥ã‡≤ß‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤ï‡≤¨‡≥ç‡≤¨‡≥Å ‡≤Æ‡≥Å‡≤Ç‡≤§‡≤æ‡≤¶ ‡≤∏‡≥ç‡≤•‡≤≥‡≥Ä‡≤Ø ‡≤¨‡≥Ü‡≤≥‡≥Ü‡≤ó‡≤≥‡≤ø‡≤ó‡≥Ü ‡≤¶‡≥à‡≤®‡≤Ç‡≤¶‡≤ø‡≤® ‡≤ï‡≥É‡≤∑‡≤ø ‡≤∏‡≤≤‡≤π‡≥Ü‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤í‡≤¶‡≤ó‡≤ø‡≤∏‡≤ø. ‡≤∏‡≤≤‡≤π‡≥Ü‡≤Ø‡≥Å ‡≤∞‡≥à‡≤§‡≤∞‡≥ä‡≤Ç‡≤¶‡≤ø‡≤ó‡≥Ü ‡≤®‡≥á‡≤∞‡≤µ‡≤æ‡≤ó‡≤ø ‡≤Æ‡≤æ‡≤§‡≤®‡≤æ‡≤°‡≥Å‡≤µ‡≤Ç‡≤§‡≥Ü ‡≤∏‡≥ç‡≤®‡≥á‡≤π‡≤™‡≤∞, ‡≤∏‡≤Ç‡≤µ‡≤æ‡≤¶‡≤æ‡≤§‡≥ç‡≤Æ‡≤ï ‡≤ß‡≥ç‡≤µ‡≤®‡≤ø‡≤Ø‡≤≤‡≥ç‡≤≤‡≤ø‡≤∞‡≤¨‡≥á‡≤ï‡≥Å ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤™‡≤æ‡≤Ø‡≤ø‡≤Ç‡≤ü‡≥ç‚Äå‡≤ó‡≤≥‡≤≤‡≥ç‡≤≤‡≤ø ‡≤â‡≤§‡≥ç‡≤§‡≤∞‡≤ø‡≤∏‡≤ø‡•§`,
                    'ml': `‡¥á‡¥®‡µç‡¥®‡µç ${userLocation} ‡¥Ø‡¥ø‡¥≤‡µÜ ‡¥ï‡¥æ‡¥≤‡¥æ‡¥µ‡¥∏‡µç‡¥• ‡¥é‡¥ô‡µç‡¥ô‡¥®‡µÜ‡¥Ø‡¥æ‡¥£‡µç, ‡¥Ö‡¥§‡¥ø‡¥®‡µÜ ‡¥Ö‡¥ü‡¥ø‡¥∏‡µç‡¥•‡¥æ‡¥®‡¥Æ‡¥æ‡¥ï‡µç‡¥ï‡¥ø, ‡¥®‡µÜ‡¥≤‡µç‡¥≤‡µç, ‡¥ó‡µã‡¥§‡¥Æ‡µç‡¥™‡µç, ‡¥ï‡¥∞‡¥ø‡¥Æ‡µç‡¥™‡µç ‡¥é‡¥®‡µç‡¥®‡¥ø‡¥µ‡¥Ø‡µÅ‡¥ü‡µÜ ‡¥™‡µç‡¥∞‡¥æ‡¥¶‡µá‡¥∂‡¥ø‡¥ï ‡¥µ‡¥ø‡¥≥‡¥ï‡µæ‡¥ï‡µç‡¥ï‡¥æ‡¥Ø‡¥ø ‡¥í‡¥∞‡µÅ ‡¥¶‡¥ø‡¥®‡¥Ç‡¥™‡µç‡¥∞‡¥§‡¥ø ‡¥ï‡¥æ‡µº‡¥∑‡¥ø‡¥ï ‡¥â‡¥™‡¥¶‡µá‡¥∂‡¥Ç ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï. ‡¥â‡¥™‡¥¶‡µá‡¥∂‡¥Ç ‡¥∏‡µó‡¥π‡µÉ‡¥¶‡¥™‡¥∞‡¥µ‡µÅ‡¥Ç ‡¥™‡µã‡¥Ø‡¥ø‡¥®‡µç‡¥±‡µÅ‡¥ï‡¥≥‡¥ø‡¥≤‡µÅ‡¥Æ‡¥æ‡¥Ø‡¥ø‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡¥£‡¥Ç.`, // **UPDATED MALAYALAM PROMPT**
                };
                const prompt = prompts[currentLanguage] || prompts['en'];
                addMessage(`I am fetching your daily advisory for ${userLocation}...`, 'user');
                callGeminiAPI(prompt, null, true);
            });

            imageAnalysisButton.addEventListener('click', () => {
                imageModal.classList.remove('hidden');
            });

            govtSchemesButton.addEventListener('click', () => {
                const prompts = {
                    // **MODIFIED:** Replaced 'Greater Noida, Uttar Pradesh, India' with ${userLocation}
                    'en': `What are the most recent local government schemes and subsidies available for farmers in ${userLocation}? Please list them in a concise, bulleted format. **(STRICTLY RESPOND IN ENGLISH)**`,
                    'hi': `${userLocation} ‡§Æ‡•á‡§Ç ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§µ‡•Ä‡§®‡§§‡§Æ ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç ‡§î‡§∞ ‡§∏‡§¨‡•ç‡§∏‡§ø‡§°‡•Ä ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à‡§Ç? ‡§ï‡•É‡§™‡§Ø‡§æ ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§è‡§ï ‡§∏‡§Ç‡§ï‡•ç‡§∑‡§ø‡§™‡•ç‡§§, ‡§¨‡•Å‡§≤‡•á‡§ü‡•á‡§° ‡§™‡•ç‡§∞‡§æ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§∏‡•Ç‡§ö‡•Ä‡§¨‡§¶‡•ç‡§ß ‡§ï‡§∞‡•á‡§Ç‡•§`,
                    'ta': `${userLocation} ‡Æá‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥ ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡Æø‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æ© ‡Æö‡ÆÆ‡ØÄ‡Æ™‡Æ§‡Øç‡Æ§‡Æø‡ÆØ ‡Æâ‡Æ≥‡Øç‡Æ≥‡ØÇ‡Æ∞‡Øç ‡ÆÖ‡Æ∞‡Æö‡ØÅ ‡Æ§‡Æø‡Æü‡Øç‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡Ææ‡Æ©‡Æø‡ÆØ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆØ‡Ææ‡Æµ‡Øà? ‡ÆÖ‡Æµ‡Æ±‡Øç‡Æ±‡Øà ‡Æí‡Æ∞‡ØÅ ‡Æö‡ØÅ‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ÆÆ‡Ææ‡Æ©, ‡Æ™‡ØÅ‡Æ≤‡Øç‡Æ≤‡Æü‡Øç ‡Æµ‡Æü‡Æø‡Æµ‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡Æ™‡Æü‡Øç‡Æü‡Æø‡ÆØ‡Æ≤‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç‡•§`,
                    'kn': `${userLocation} ‡≤∞‡≥à‡≤§‡≤∞‡≤ø‡≤ó‡≥Ü ‡≤≤‡≤≠‡≥ç‡≤Ø‡≤µ‡≤ø‡≤∞‡≥Å‡≤µ ‡≤á‡≤§‡≥ç‡≤§‡≥Ä‡≤ö‡≤ø‡≤® ‡≤∏‡≥ç‡≤•‡≤≥‡≥Ä‡≤Ø ‡≤∏‡≤∞‡≤ï‡≤æ‡≤∞ ‡≤Ø‡≥ã‡≤ú‡≤®‡≥Ü‡≤ó‡≤≥‡≥Å ‡≤Ø‡≤æ‡≤µ‡≥Å‡≤µ‡≥Å? ‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å ‡≤Ö‡≤µ‡≥Å‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤ï‡≥ç‡≤∑‡≤ø‡≤™‡≥ç‡≤§, ‡≤¨‡≥Å‡≤≤‡≥Ü‡≤ü‡≥ç ‡≤∞‡≥Ç‡≤™‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤™‡≤ü‡≥ç‡≤ü‡≤ø ‡≤Æ‡≤æ‡≤°‡≤ø‡•§`,
                    'ml': `${userLocation} ‡¥≤‡µÜ ‡¥ï‡µº‡¥∑‡¥ï‡µº‡¥ï‡µç‡¥ï‡µç ‡¥≤‡¥≠‡µç‡¥Ø‡¥Æ‡¥æ‡¥Ø ‡¥è‡¥±‡µç‡¥±‡¥µ‡µÅ‡¥Ç ‡¥™‡µÅ‡¥§‡¥ø‡¥Ø ‡¥™‡µç‡¥∞‡¥æ‡¥¶‡µá‡¥∂‡¥ø‡¥ï ‡¥∏‡µº‡¥ï‡µç‡¥ï‡¥æ‡µº ‡¥™‡¥¶‡µç‡¥ß‡¥§‡¥ø‡¥ï‡¥≥‡µÅ‡¥Ç ‡¥∏‡¥¨‡µç‚Äå‡¥∏‡¥ø‡¥°‡¥ø‡¥ï‡¥≥‡µÅ‡¥Ç ‡¥é‡¥®‡µç‡¥§‡µä‡¥ï‡µç‡¥ï‡µÜ‡¥Ø‡¥æ‡¥£‡µç? ‡¥¶‡¥Ø‡¥µ‡¥æ‡¥Ø‡¥ø ‡¥Ö‡¥µ‡¥Ø‡µÜ ‡¥∏‡¥Ç‡¥ï‡µç‡¥∑‡¥ø‡¥™‡µç‡¥§‡¥µ‡µÅ‡¥Ç ‡¥™‡µã‡¥Ø‡¥ø‡¥®‡µç‡¥±‡µÅ‡¥ï‡¥≥‡¥ø‡¥≤‡µÅ‡¥Æ‡µÅ‡¥≥‡µç‡¥≥ ‡¥´‡µã‡µº‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥ø‡µΩ ‡¥™‡¥ü‡µç‡¥ü‡¥ø‡¥ï‡¥™‡µç‡¥™‡µÜ‡¥ü‡µÅ‡¥§‡µç‡¥§‡µÅ‡¥ï‡•§` // ADDED MALAYALAM
                };
                const prompt = prompts[currentLanguage] || prompts['en'];
                addMessage(`I am searching for the latest government schemes for you in ${userLocation}...`, 'user');
                callGeminiAPI(prompt, null, true);
            });

            marketPriceButton.addEventListener('click', () => {
                const prompts = {
                    // **MODIFIED:** Replaced 'Greater Noida, Uttar Pradesh, India' with ${userLocation}
                    'en': `What are the current market prices for rice, wheat, and sugarcane in ${userLocation}? Provide the information in a clear, easy-to-read format. **(STRICTLY RESPOND IN ENGLISH)**`,
                    'hi': `${userLocation} ‡§Æ‡•á‡§Ç ‡§ö‡§æ‡§µ‡§≤, ‡§ó‡•á‡§π‡•Ç‡§Ç ‡§î‡§∞ ‡§ó‡§®‡•ç‡§®‡•á ‡§ï‡•á ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§≠‡§æ‡§µ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à‡§Ç? ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•ã ‡§è‡§ï ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü, ‡§™‡§¢‡§º‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Ü‡§∏‡§æ‡§® ‡§™‡•ç‡§∞‡§æ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§`,
                    'ta': `${userLocation} ‡Æá‡Æ≤‡Øç ‡ÆÖ‡Æ∞‡Æø‡Æö‡Æø, ‡Æï‡Øã‡Æ§‡ØÅ‡ÆÆ‡Øà, ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æï‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡ØÅ ‡ÆÜ‡Æï‡Æø‡ÆØ‡Æµ‡Æ±‡Øç‡Æ±‡Æø‡Æ©‡Øç ‡Æ§‡Æ±‡Øç‡Æ™‡Øã‡Æ§‡Øà‡ÆØ ‡Æö‡Æ®‡Øç‡Æ§‡Øà ‡Æµ‡Æø‡Æ≤‡Øà‡Æï‡Æ≥‡Øç ‡Æé‡Æ©‡Øç‡Æ©? ‡Æ§‡Æï‡Æµ‡Æ≤‡Øà‡Æ§‡Øç ‡Æ§‡ØÜ‡Æ≥‡Æø‡Æµ‡Ææ‡Æ©, ‡Æé‡Æ≥‡Æø‡Æ§‡Ææ‡Æï‡Æ™‡Øç ‡Æ™‡Æü‡Æø‡Æï‡Øç‡Æï‡Æï‡Øç‡Æï‡ØÇ‡Æü‡Æø‡ÆØ ‡Æµ‡Æü‡Æø‡Æµ‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡Æµ‡Æ¥‡Æô‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç‡•§`,
                    'kn': `${userLocation} ‡≤®‡≤≤‡≥ç‡≤≤‡≤ø ‡≤≠‡≤§‡≥ç‡≤§, ‡≤ó‡≥ã‡≤ß‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤ï‡≤¨‡≥ç‡≤¨‡≤ø‡≤® ‡≤™‡≥ç‡≤∞‡≤∏‡≥ç‡≤§‡≥Å‡≤§ ‡≤Æ‡≤æ‡≤∞‡≥Å‡≤ï‡≤ü‡≥ç‡≤ü‡≥Ü ‡≤¨‡≥Ü‡≤≤‡≥Ü‡≤ó‡≤≥‡≥Å ‡≤Ø‡≤æ‡≤µ‡≥Å‡≤µ‡≥Å? ‡≤Æ‡≤æ‡≤π‡≤ø‡≤§‡≤ø‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≥ç‡≤™‡≤∞‡≥ç‡≤∂‡≤ø‡≤§, ‡≤∏‡≥Å‡≤≤‡≤≠‡≤µ‡≤æ‡≤ó‡≤ø ‡≤ì‡≤¶‡≤≤‡≥ç‡≤™‡≤°‡≥Å‡≤µ ‡≤∏‡≥ç‡≤µ‡≤∞‡≥Ç‡≤™‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤®‡≥Ä‡≤°‡≤ø‡•§`,
                    'ml': `${userLocation} ‡¥≤‡µÜ ‡¥®‡µÜ‡¥≤‡µç‡¥≤‡µç, ‡¥ó‡µã‡¥§‡¥Æ‡µç‡¥™‡µç, ‡¥ï‡¥∞‡¥ø‡¥Æ‡µç‡¥™‡µç ‡¥é‡¥®‡µç‡¥®‡¥ø‡¥µ‡¥Ø‡µÅ‡¥ü‡µÜ ‡¥®‡¥ø‡¥≤‡¥µ‡¥ø‡¥≤‡µÜ ‡¥Æ‡¥æ‡µº‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡µç ‡¥µ‡¥ø‡¥≤‡¥ï‡µæ ‡¥é‡¥®‡µç‡¥§‡µä‡¥ï‡µç‡¥ï‡µÜ‡¥Ø‡¥æ‡¥£‡µç? ‡¥µ‡¥ø‡¥µ‡¥∞‡¥ô‡µç‡¥ô‡µæ ‡¥µ‡µç‡¥Ø‡¥ï‡µç‡¥§‡¥µ‡µÅ‡¥Ç ‡¥é‡¥≥‡µÅ‡¥™‡µç‡¥™‡¥§‡µç‡¥§‡¥ø‡µΩ ‡¥µ‡¥æ‡¥Ø‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡¥µ‡µÅ‡¥®‡µç‡¥®‡¥§‡µÅ‡¥Æ‡¥æ‡¥Ø ‡¥´‡µã‡µº‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥ø‡µΩ ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï‡•§` // ADDED MALAYALAM
                };
                const prompt = prompts[currentLanguage] || prompts['en'];
                addMessage(`I am fetching the latest market prices for you in ${userLocation}...`, "user");
                callGeminiAPI(prompt, null, true);
            });
            
            // NEW BUTTON LOGIC FOR LOCAL NEWS
            localNewsButton.addEventListener('click', () => {
                const prompts = {
                    'en': `What are the top 3-5 latest news headlines or important announcements relevant to farmers and agriculture in ${userLocation}? Provide the news items with short bullet points, titles, and a link if available. **(STRICTLY RESPOND IN ENGLISH)**`,
                    'hi': `${userLocation} ‡§Æ‡•á‡§Ç ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§î‡§∞ ‡§ï‡•É‡§∑‡§ø ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§∂‡•Ä‡§∞‡•ç‡§∑ 3-5 ‡§®‡§µ‡•Ä‡§®‡§§‡§Æ ‡§∏‡§Æ‡§æ‡§ö‡§æ‡§∞ ‡§∏‡•Å‡§∞‡•ç‡§ñ‡§ø‡§Ø‡§æ‡§Å ‡§Ø‡§æ ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ò‡•ã‡§∑‡§£‡§æ‡§è‡§Å ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à‡§Ç? ‡§∏‡§Æ‡§æ‡§ö‡§æ‡§∞ ‡§µ‡§∏‡•ç‡§§‡•Å‡§ì‡§Ç ‡§ï‡•ã ‡§∏‡§Ç‡§ï‡•ç‡§∑‡§ø‡§™‡•ç‡§§ ‡§¨‡•Å‡§≤‡•á‡§ü ‡§™‡•â‡§á‡§Ç‡§ü, ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï‡•ã‡§Ç ‡§î‡§∞ ‡§Ø‡§¶‡§ø ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•ã ‡§§‡•ã ‡§≤‡§ø‡§Ç‡§ï ‡§ï‡•á ‡§∏‡§æ‡§• ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§`,
                    'ta': `${userLocation} ‡Æá‡Æ≤‡Øç ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡Æø‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡ÆÆ‡Øç ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æ™‡Ææ‡Æ© ‡ÆÆ‡ØÅ‡Æ§‡Æ≤‡Øç 3-5 ‡Æö‡ÆÆ‡ØÄ‡Æ™‡Æ§‡Øç‡Æ§‡Æø‡ÆØ ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡Æø ‡Æ§‡Æ≤‡Øà‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡ÆÆ‡ØÅ‡Æï‡Øç‡Æï‡Æø‡ÆØ‡ÆÆ‡Ææ‡Æ© ‡ÆÖ‡Æ±‡Æø‡Æµ‡Æø‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç ‡ÆØ‡Ææ‡Æµ‡Øà? ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡Æø ‡Æâ‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡Æü‡Æø‡Æï‡Æ≥‡Øà ‡Æö‡ØÅ‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ÆÆ‡Ææ‡Æ© ‡Æ™‡ØÅ‡Æ≤‡Øç‡Æ≤‡Æü‡Øç ‡Æ™‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æø‡Æï‡Æ≥‡Øç, ‡Æ§‡Æ≤‡Øà‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æí‡Æ∞‡ØÅ ‡Æá‡Æ£‡Øà‡Æ™‡Øç‡Æ™‡ØÅ‡Æü‡Æ©‡Øç (‡Æï‡Æø‡Æü‡Øà‡Æ§‡Øç‡Æ§‡Ææ‡Æ≤‡Øç) ‡Æµ‡Æ¥‡Æô‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.`,
                    'kn': `${userLocation} ‡≤®‡≤≤‡≥ç‡≤≤‡≤ø ‡≤∞‡≥à‡≤§‡≤∞‡≥Å ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤ï‡≥É‡≤∑‡≤ø‡≤ó‡≥Ü ‡≤∏‡≤Ç‡≤¨‡≤Ç‡≤ß‡≤ø‡≤∏‡≤ø‡≤¶ ‡≤™‡≥ç‡≤∞‡≤Æ‡≥Å‡≤ñ 3-5 ‡≤á‡≤§‡≥ç‡≤§‡≥Ä‡≤ö‡≤ø‡≤® ‡≤∏‡≥Å‡≤¶‡≥ç‡≤¶‡≤ø ‡≤Æ‡≥Å‡≤ñ‡≥ç‡≤Ø‡≤æ‡≤Ç‡≤∂‡≤ó‡≤≥‡≥Å ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤™‡≥ç‡≤∞‡≤Æ‡≥Å‡≤ñ ‡≤™‡≥ç‡≤∞‡≤ï‡≤ü‡≤£‡≥Ü‡≤ó‡≤≥‡≥Å ‡≤Ø‡≤æ‡≤µ‡≥Å‡≤µ‡≥Å? ‡≤∏‡≥Å‡≤¶‡≥ç‡≤¶‡≤ø ‡≤µ‡≤∏‡≥ç‡≤§‡≥Å‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤ï‡≥ç‡≤∑‡≤ø‡≤™‡≥ç‡≤§ ‡≤¨‡≥Å‡≤≤‡≥Ü‡≤ü‡≥ç ‡≤™‡≤æ‡≤Ø‡≤ø‡≤Ç‡≤ü‡≥ç‚Äå‡≤ó‡≤≥‡≥Å, ‡≤∂‡≥Ä‡≤∞‡≥ç‡≤∑‡≤ø‡≤ï‡≥Ü‡≤ó‡≤≥‡≥Å ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤≤‡≤≠‡≥ç‡≤Ø‡≤µ‡≤ø‡≤¶‡≥ç‡≤¶‡≤∞‡≥Ü ‡≤≤‡≤ø‡≤Ç‡≤ï‡≥ç‚Äå‡≤®‡≥ä‡≤Ç‡≤¶‡≤ø‡≤ó‡≥Ü ‡≤í‡≤¶‡≤ó‡≤ø‡≤∏‡≤ø.`,
                    'ml': `${userLocation} ‡¥≤‡µÜ ‡¥ï‡µº‡¥∑‡¥ï‡µº‡¥ï‡µç‡¥ï‡µÅ‡¥Ç ‡¥ï‡µÉ‡¥∑‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥Ç ‡¥™‡µç‡¥∞‡¥∏‡¥ï‡µç‡¥§‡¥Æ‡¥æ‡¥Ø ‡¥è‡¥±‡µç‡¥±‡¥µ‡µÅ‡¥Ç ‡¥™‡µÅ‡¥§‡¥ø‡¥Ø 3-5 ‡¥™‡µç‡¥∞‡¥ß‡¥æ‡¥® ‡¥µ‡¥æ‡µº‡¥§‡µç‡¥§‡¥æ ‡¥§‡¥≤‡¥ï‡µç‡¥ï‡µÜ‡¥ü‡µç‡¥ü‡µÅ‡¥ï‡¥≥‡µã ‡¥™‡µç‡¥∞‡¥ß‡¥æ‡¥®‡¥™‡µç‡¥™‡µÜ‡¥ü‡µç‡¥ü ‡¥Ö‡¥±‡¥ø‡¥Ø‡¥ø‡¥™‡µç‡¥™‡µÅ‡¥ï‡¥≥‡µã ‡¥é‡¥®‡µç‡¥§‡µä‡¥ï‡µç‡¥ï‡µÜ‡¥Ø‡¥æ‡¥£‡µç? ‡¥µ‡¥æ‡µº‡¥§‡µç‡¥§‡¥æ ‡¥á‡¥®‡¥ô‡µç‡¥ô‡µæ ‡¥ö‡µÜ‡¥±‡¥ø‡¥Ø ‡¥™‡µã‡¥Ø‡¥ø‡¥®‡µç‡¥±‡µÅ‡¥ï‡µæ, ‡¥§‡¥≤‡¥ï‡µç‡¥ï‡µÜ‡¥ü‡µç‡¥ü‡µÅ‡¥ï‡µæ, ‡¥≤‡¥≠‡µç‡¥Ø‡¥Æ‡¥æ‡¥£‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥≤‡¥ø‡¥ô‡µç‡¥ï‡µç ‡¥é‡¥®‡µç‡¥®‡¥ø‡¥µ ‡¥∏‡¥π‡¥ø‡¥§‡¥Ç ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï.`,
                };
                const prompt = prompts[currentLanguage] || prompts['en'];
                addMessage(`I am fetching the top local agriculture news for ${userLocation}...`, "user");
                callGeminiAPI(prompt, null, true); // Grounded call to fetch current news
            });
            // END NEW BUTTON LOGIC FOR LOCAL NEWS


            // NEW BUTTON LOGIC - MODIFIED TO USE userLocation
            officerDetailsButton.addEventListener('click', () => {
                const prompts = {
                    // **MODIFIED:** Replaced 'Greater Noida, Uttar Pradesh, India' with ${userLocation}
                    'en': `Provide contact details (phone number, address) for the nearest Krishi Vigyan Kendra (KVK) and District Agriculture Officer (DAO) for the ${userLocation} area. List the information clearly with names and titles. **(STRICTLY RESPOND IN ENGLISH)**`,
                    'hi': ` ${userLocation} ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§ø‡§ï‡§ü‡§§‡§Æ ‡§ï‡•É‡§∑‡§ø ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞ (KVK) ‡§î‡§∞ ‡§ú‡§ø‡§≤‡§æ ‡§ï‡•É‡§∑‡§ø ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡•Ä (DAO) ‡§ï‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§µ‡§ø‡§µ‡§∞‡§£ (‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞, ‡§™‡§§‡§æ) ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•ã ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§™‡§¶‡§®‡§æ‡§Æ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡•Ç‡§ö‡•Ä‡§¨‡§¶‡•ç‡§ß ‡§ï‡§∞‡•á‡§Ç‡•§`,
                    'ta': `${userLocation} ‡Æ™‡Æï‡ØÅ‡Æ§‡Æø‡Æï‡Øç‡Æï‡ØÅ ‡ÆÖ‡Æ∞‡ØÅ‡Æï‡Æø‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥ ‡Æµ‡Øá‡Æ≥‡Ææ‡Æ£‡Øç ‡ÆÖ‡Æ±‡Æø‡Æµ‡Æø‡ÆØ‡Æ≤‡Øç ‡ÆÆ‡Øà‡ÆØ‡ÆÆ‡Øç (KVK) ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡Ææ‡Æµ‡Æü‡Øç‡Æü ‡Æµ‡Øá‡Æ≥‡Ææ‡Æ£‡Øç‡ÆÆ‡Øà ‡ÆÖ‡Æ§‡Æø‡Æï‡Ææ‡Æ∞‡Æø (DAO) ‡ÆÜ‡Æï‡Æø‡ÆØ‡Øã‡Æ∞‡Æø‡Æ©‡Øç ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æ™‡ØÅ ‡Æµ‡Æø‡Æµ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øà (‡Æ§‡Øä‡Æ≤‡Øà‡Æ™‡Øá‡Æö‡Æø ‡Æé‡Æ£‡Øç, ‡ÆÆ‡ØÅ‡Æï‡Æµ‡Æ∞‡Æø) ‡Æµ‡Æ¥‡Æô‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç. ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Æ§‡Æµ‡Æø‡ÆØ‡ØÅ‡Æü‡Æ©‡Øç ‡Æ§‡ØÜ‡Æ≥‡Æø‡Æµ‡Ææ‡Æï‡Æ™‡Øç ‡Æ™‡Æü‡Øç‡Æü‡Æø‡ÆØ‡Æ≤‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç‡•§`,
                    'kn': `${userLocation} ‡≤™‡≥ç‡≤∞‡≤¶‡≥á‡≤∂‡≤ï‡≥ç‡≤ï‡≤æ‡≤ó‡≤ø ‡≤π‡≤§‡≥ç‡≤§‡≤ø‡≤∞‡≤¶ ‡≤ï‡≥É‡≤∑‡≤ø ‡≤µ‡≤ø‡≤ú‡≥ç‡≤û‡≤æ‡≤® ‡≤ï‡≥á‡≤Ç‡≤¶‡≥ç‡≤∞ (KVK) ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤ú‡≤ø‡≤≤‡≥ç‡≤≤‡≤æ ‡≤ï‡≥É‡≤∑‡≤ø ‡≤Ö‡≤ß‡≤ø‡≤ï‡≤æ‡≤∞‡≤ø‡≤Ø (DAO) ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï ‡≤µ‡≤ø‡≤µ‡≤∞‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å (‡≤´‡≥ã‡≤®‡≥ç ‡≤∏‡≤Ç‡≤ñ‡≥ç‡≤Ø‡≥Ü, ‡≤µ‡≤ø‡≤≥‡≤æ‡≤∏) ‡≤í‡≤¶‡≤ó‡≤ø‡≤∏‡≤ø. ‡≤π‡≥Ü‡≤∏‡≤∞‡≥Å ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤π‡≥Å‡≤¶‡≥ç‡≤¶‡≥Ü‡≤ó‡≤≥‡≥ä‡≤Ç‡≤¶‡≤ø‡≤ó‡≥Ü ‡≤Æ‡≤æ‡≤π‡≤ø‡≤§‡≤ø‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≥ç‡≤™‡≤∑‡≥ç‡≤ü‡≤µ‡≤æ‡≤ó‡≤ø ‡≤™‡≤ü‡≥ç‡≤ü‡≤ø ‡≤Æ‡≤æ‡≤°‡≤ø‡•§`,
                    'ml': `${userLocation} ‡¥™‡µç‡¥∞‡¥¶‡µá‡¥∂‡¥§‡µç‡¥§‡¥ø‡¥®‡µç ‡¥∏‡¥Æ‡µÄ‡¥™‡¥Æ‡µÅ‡¥≥‡µç‡¥≥ ‡¥ï‡µÉ‡¥∑‡¥ø ‡¥µ‡¥ø‡¥ú‡µç‡¥û‡¥æ‡¥® ‡¥ï‡µá‡¥®‡µç‡¥¶‡µç‡¥∞‡¥§‡µç‡¥§‡¥ø‡¥®‡µç‡¥±‡µÜ‡¥Ø‡µÅ‡¥Ç (KVK) ‡¥ú‡¥ø‡¥≤‡µç‡¥≤‡¥æ ‡¥ï‡µÉ‡¥∑‡¥ø ‡¥ì‡¥´‡µÄ‡¥∏‡¥±‡µÅ‡¥ü‡µÜ‡¥Ø‡µÅ‡¥Ç (DAO) ‡¥¨‡¥®‡µç‡¥ß‡¥™‡µç‡¥™‡µÜ‡¥ü‡¥æ‡¥®‡µÅ‡¥≥‡µç‡¥≥ ‡¥µ‡¥ø‡¥µ‡¥∞‡¥ô‡µç‡¥ô‡µæ (‡¥´‡µã‡µ∫ ‡¥®‡¥Æ‡µç‡¥™‡µº, ‡¥µ‡¥ø‡¥≤‡¥æ‡¥∏‡¥Ç) ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï. ‡¥™‡µá‡¥∞‡µÅ‡¥Ç ‡¥™‡¥¶‡¥µ‡¥ø‡¥Ø‡µÅ‡¥Ç ‡¥∏‡¥π‡¥ø‡¥§‡¥Ç ‡¥µ‡¥ø‡¥µ‡¥∞‡¥ô‡µç‡¥ô‡µæ ‡¥µ‡µç‡¥Ø‡¥ï‡µç‡¥§‡¥Æ‡¥æ‡¥Ø‡¥ø ‡¥™‡¥ü‡µç‡¥ü‡¥ø‡¥ï‡¥™‡µç‡¥™‡µÜ‡¥ü‡µÅ‡¥§‡µç‡¥§‡µÅ‡¥ï‡•§`
                };
                const prompt = prompts[currentLanguage] || prompts['en'];
                addMessage(`I am searching for the local agricultural officer's contact details for ${userLocation}...`, "user");
                callGeminiAPI(prompt, null, true);
            });
            // END NEW BUTTON LOGIC

            // --- Mic Button ---
            micButton.addEventListener('click', () => {
                if (!('SpeechRecognition' in window) && !('webkitSpeechRecognition' in window)) {
                    showAlert("Feature Not Supported", "Your browser does not support speech recognition. Please try using Chrome or Firefox.");
                    return;
                }
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();
                // UPDATED SPEECH RECOGNITION LANG CONFIGURATION
                recognition.lang =
                    currentLanguage === 'ml' ? 'ml-IN' : // ADDED MALAYALAM
                    currentLanguage === 'ta' ? 'ta-IN' :
                    currentLanguage === 'kn' ? 'kn-IN' :
                    currentLanguage === 'hi' ? 'hi-IN' :
                    'en-IN';

                recognition.interimResults = false;
                recognition.maxAlternatives = 1;

                recognition.onstart = () => {
                    micButton.style.backgroundColor = '#dc2626';
                    userInput.placeholder = 'Listening...';
                };
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    userInput.value = transcript;
                    handleSendMessage();
                };
                recognition.onend = () => {
                    micButton.style.backgroundColor = '#3B82F6';
                    userInput.placeholder = placeholders[currentLanguage];
                };
                recognition.onerror = (event) => {
                    console.error('Speech recognition error', event.error);
                    showAlert("Speech Recognition Error", "There was an error recognizing your speech. Please try again.");
                };
                recognition.start();
            });

            // --- Image Modal ---
            modalCloseButton.addEventListener('click', () => {
                imageModal.classList.add('hidden');
            });

            modalUploadButton.addEventListener('click', () => {
                const file = modalImageInput.files[0];
                if (!file) {
                    showAlert("No Image Selected", "Please select an image to upload.");
                    return;
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    const base64Image = e.target.result;
                    addMessage(base64Image, 'user', true);
                    imageModal.classList.add('hidden');
                    const imagePrompt = "Please analyze this image and provide a diagnosis and solution for any pests or diseases. Be specific. **(STRICTLY RESPOND IN ENGLISH)**";
                    callGeminiAPI(imagePrompt, base64Image);
                };
                reader.readAsDataURL(file);
            });

            // Set up initial welcome message timestamp
            const initialWelcomeMessage = document.querySelector('#chat-container .ai-message');
            const timestamp = document.createElement('span');
            timestamp.classList.add('message-timestamp');
            timestamp.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            if (initialWelcomeMessage) initialWelcomeMessage.appendChild(timestamp);
        });
    </script>
</body>
</html>